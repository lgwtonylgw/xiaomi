!function(t){function e(i){if(o[i])return o[i].exports;var a=o[i]={exports:{},id:i,loaded:!1};return t[i].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){t.exports=o(1)},function(t,e,o){function i(){var t=$(window).width(),e=$(".J_homeRightBar");1440>=t?($(".J_barToTopL").hide(),$(".J_barToTopS").show(),e.addClass("home-right-bar-show-s")):(e.removeClass("home-right-bar-show-s"),$(".J_barToTopS").hide(),$(".J_barToTopL").show())}function a(){function t(){if(o=document.documentElement.scrollTop||document.body.scrollTop,o===e){var t=$(window).height(),a=$(document).scrollTop();a>=t?($(".J_barToTop").removeClass("hidden"),i()):$(".J_barToTop").addClass("hidden")}}var e=0,o=0,a=null;document.onscroll=function(){clearTimeout(a),a=setTimeout(t,500),e=document.documentElement.scrollTop||document.body.scrollTop}}function n(){$(".J_barToTop").click(function(){$(document).scrollTop(0)})}MI.namespace("goodsDetail, goodsComment, itemUtil"),MI.goodsComment=o(2),MI.goodsQuestion=o(6),MI.itemUtil=o(4),MI.cart=o(8),o(9),o(13),o(14);var s=o(16);MI.goodsDetailUtil={dotmpl:function(t,e){var o=t.html(),i=doT.template(o);return i(e)},cutImg:function(t,e){var o=t.lastIndexOf(".");if(-1!==t.indexOf("!"))return t;var i=t.substring(0,o)+"!"+e+"x"+e+t.substring(o);return i},loadjsSync:function(t,e,o){var i,a,n;__indexOf=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1},i=arguments.callee,__indexOf.call(i,"queue")<0&&(i.queue={}),a=i.queue,__indexOf.call(a,t)>=0&&e&&(a[t]?a[t].push(e):e(o)),a[t]=e?[e]:[],n=document.createElement("script"),n.type="text/javascript",n.onload=n.onreadystatechange=function(){if(!n.readyState||"loaded"===n.readyState||"complete"===n.readyState){for(n.onreadystatechange=n.onload=null;a[t].length;)a[t].shift()(o);return a[t]=null,a}},n.src=t,document.getElementsByTagName("head")[0].appendChild(n)}},MI.goodsDetail={config:function(){var t=this;t.slideIndex=0,t.pageConfig=goodsConfig,t.selectedAddr=[];var e={getCommenturlHead:MI.goodsDetailConfig.commentWwwUrl,answerCommentUrlHead:MI.goodsDetailConfig.commentOrderUrl,proId:goodsConfig.productId,recommendBlock:$("#J_recommendComment"),supCommentBlock:$("#J_supComment"),timelineCommentBlock:$("#J_timelineComment")},o={questionUrlHead:MI.goodsDetailConfig.commentHuodongUrl,proId:goodsConfig.productId,commodityId:goodsConfig.commodityId,questionBlock:$("#J_goodsQuestionBlock")};t.commentApi=new MI.goodsComment(e),t.questionApi=new MI.goodsQuestion(o)},init:function(){var t=this;t.config(),t.runMethods();var e=function(){return!!document.createElement("video").canPlayType}();e&&$.each($("video"),function(t,e){$(e)[0].play()})},runMethods:function(){var t=this;t.initLoadPage(),t.showProSlide(),t.showImgOnly(),t.refreshPrice(),t.judgeClothSize(),t.is(),t.showStoreBtnStatus(),t.changeStoreBtnStatus(),t.scorllCommentPic(),t.clickBatch(),t.clickShowBigImg(),t.clickItemImg(),t.keyboardControl(),t.getGoodsDetail()},keyboardControl:function(){document.onkeyup=function(t){var e=t||window.event,o=$("#goodsPicZoomBlock").length;e&&27===e.keyCode&&o&&$(".J_exitItemBig").click(),e&&39===e.keyCode&&o&&$(".J_itemZoomRight").click(),e&&37===e.keyCode&&o&&$(".J_itemZoomLeft").click()}},needLazyMethod:function(){var t=this;MI.goodsDetailUtil.loadjsSync("//s01.mifile.cn/c/js/shouhoufuwu.js",t.renderServicePage),$("#J_alsoBuyWrap").miRecommend({type:"alsoBuy",gid:goodsConfig.commodityId||""}),t.getCommentList(),t.getQuestionList()},initLoadPage:function(){var t=this,e=t.pageConfig,o={};o.canJoinActs=[];var i=["reduction","gift"];if(e.canJoinActs)for(var a in e.canJoinActs)if(e.canJoinActs.hasOwnProperty(a)){var n=e.canJoinActs[a],r={};r.type=-1===$.inArray(n.type,i)?"others":n.type,r.label=n.typeDesc?n.typeDesc:n.type,r.title=n.title,o.canJoinActs.push(r)}if(o.adaptDesc=e.adaptDesc,o.goodsColor={},o.goodsColor.colorName=e.commodityStyleName,e.commodityStyleList){o.goodsColor.colorArr=[];for(var d in e.commodityStyleList)if(e.commodityStyleList.hasOwnProperty(d)){var l=e.commodityStyleList[d],c={};c.goodsUrl=MI.GLOBAL_CONFIG.itemSite+"/"+l.commodity_id+".html",c.imgTitle="",c.imgTitle=l.icon_name?l.icon_name:d,c.selectedClass="",e.commodityId===l.commodity_id&&(c.selectedClass="current",o.goodsColor.curName=c.imgTitle),c.goodsBack="",l.icon?c.goodsBack=MI.goodsDetailUtil.cutImg(l.icon,38):l.image&&(c.goodsBack=MI.goodsDetailUtil.cutImg(l.image,38)),c.is_sale=l.is_sale,o.goodsColor.colorArr.push(c)}}if(o.goodsSize={},o.goodsSize.sizeName=e.goodsStyleName,0===goodsConfig.defaultGoodsId&&""!==goodsConfig.goodsStyleList){var m=!1,u=0,g={};for(var p in goodsConfig.goodsStyleList)if(goodsConfig.goodsStyleList[p]&&(0===u&&(g=goodsConfig.goodsStyleList[p]),u++,!goodsConfig.goodsStyleList[p].is_cos)){$("#J_goodsSize").find("li").eq(u).addClass("current"),m=!0,goodsConfig.defaultGoodsId=goodsConfig.goodsStyleList[p].goods_id;break}m||(goodsConfig.defaultGoodsId=g.goods_id)}if(!e.isPackage&&e.goodsStyleList){o.goodsSize.sizeArr=[];var f=0;for(var h in e.goodsStyleList)if(e.goodsStyleList.hasOwnProperty(h)){f++;var v=e.goodsStyleList[h];v.size=h,o.goodsSize.sizeArr.push(v),(v.goods_id===goodsConfig.defaultGoodsId||1===f)&&(o.goodsSize.curSize=h)}}if(o.closeSubscribe=jiangpeiConfig.closeSubscribe,o.closeFavoriteAddBtn=jiangpeiConfig.closeFavoriteAddBtn,o.nextStep="",o.addCartGid="",e.isCos)o.addCartGid=e.defaultGoodsId;else{var C=1,_="",I="",y=$.inArray(e.commodityId,MI.GLOBAL_CONFIG.damiaoGoodsId)>=0?!0:!1;e.isPackage&&!y?e.scenarioId?(_=e.commodityId+"-"+e.scenarioId+"-"+C,I=MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+_,o.rediectCartSite=!0):(_=e.commodityId+"/gid/0/c/"+C,I=MI.GLOBAL_CONFIG.cartSite+"/item/batchView/bid/"+_,o.redirectFlag=!0):(_=e.defaultGoodsId,I=MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+_),o.nextStep=I,o.addCartGid=_,e.isPackage&&!e.needChioce&&(o.addCartGid=e.commodityId)}o.is_cos=e.isCos,o.isPackage=e.isPackage,o.needChioce=e.needChioce,o.defaultGoodsId=e.defaultGoodsId,o.subUrl=MI.GLOBAL_CONFIG.orderSite+"/misc/subscribe/goods/"+e.defaultGoodsId,o.recommend_package=e.recommend_package,t.pageData=o,o.policy=e.serviceRefoundPolicy;var w=MI.goodsDetailUtil.dotmpl($("#goodsInfo-tmpl"),o);$("#J_goodsInfoBlock").append(w),s();var b=MI.goodsDetailUtil.dotmpl($("#goodsSubBar-tmpl"),o);$("#goodsSubBar").append(b),$(".J_addressWrap").append(MI.goodsDetailUtil.dotmpl($("#J_addressTmp"),"")),this.loadAddress()},loadAddress:function(){this.selectedAddr.length?this.checkSelectAddr():this.chooseRegionsInit()},chooseRegionsInit:function(){var t=this;MI.buyChooseAddress.init({showTrigger:"#J_switchChooseRegions",isShowStreet:!0,afterChoose:function(e){e&&e.length&&(t.selectedAddr=e,$("#J_modalChooseRegions").modal("hide"),t.checkSelectAddr())}})},setBtn:function(t){var e=this,o=this.pageData.addCartGid,i=$.inArray(o,MI.GLOBAL_CONFIG.damiaoGoodsId)>=0?!0:!1;if(i){var a=MI.GLOBAL_CONFIG.damiaoSite+"hdinfo/cn";return void $.ajax({type:"GET",data:{m:1,source:"bigtap",storage:e.selectedAddr.warehouse},url:a,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdinfo",timeour:1e4,error:function(){},success:function(t){t.status[o]||(t.status[o].hdstatus=3),2!==t.status[o].hdstatus?(e.pageData.is_cos=!0,$("#J_productStatus").addClass("soldout").removeClass("active  noserver").find(".time").html(""),$(".address-info").css("margin-left","118px")):(e.pageData.is_cos=!1,$("#J_productStatus").addClass("active").removeClass("soldout noserver presales").find(".time").html(""),$(".address-info").css("margin-left",0)),$("#goodsDetailBtnBox .buy-wrap,#goodsSubBarBtnBox").html(MI.goodsDetailUtil.dotmpl($("#J_buybtn-tmpl"),e.pageData))}})}this.pageData.is_cos=t||!1,$("#goodsDetailBtnBox .buy-wrap,#goodsSubBarBtnBox").html(MI.goodsDetailUtil.dotmpl($("#J_buybtn-tmpl"),this.pageData))},checkSelectAddr:function(){var t=this,e=function(){$("#J_productStatus").addClass("noserver").removeClass("over active").find(".time").html(""),t.setBtn(!0)},o=function(){$("#J_productStatus").addClass("soldout").removeClass("active  noserver").find(".time").html(""),t.setBtn(!0)},i=function(){$("#J_productStatus").addClass("nopro").removeClass("active  noserver soldout").find(".time").html(""),$(".address-info").css("margin-left",0),t.setBtn(!0)},a=t.selectedAddr.length>4?1:0,n={product_id:goodsConfig.defaultGoodsId,item_id:0,province_id:t.selectedAddr[a+0].id,city_id:t.selectedAddr[a+1].id,district_id:t.selectedAddr[a+2].id,area:t.selectedAddr[a+3].id};goodsConfig.isPackage&&(n.product_id=goodsConfig.commodityId),$(".address-info").css("margin-left",$("#J_productStatus").width()+20),MI.itemUtil.jsonP({url:MI.GLOBAL_CONFIG.orderSite+"/api/deliverySearch.php",data:n},function(a){return!goodsConfig.isPackage&&goodsConfig.defaultGoodsId&&$.inArray(MI.GLOBAL_CONFIG.damiaoGoodsId,goodsConfig.defaultGoodsId.toString())>=0?void i():goodsConfig.defaultGoodsId||goodsConfig.isPackage?(a&&1===a.code?(t.selectedAddr.warehouse=a.data.mihome_id,1===a.data.can_delivery?a.data.is_cos?o():($("#J_productStatus").addClass("active").removeClass("soldout noserver presales").find(".time").html(a.data.est_delivery_desc),t.setBtn()):e()):e(),void $(".address-info").css("margin-left",$("#J_productStatus").width()+20)):void i()})},changeProSlidCallback:function(t){var e=function(){var e={img:o},i=MI.goodsDetailUtil.dotmpl($("#bigImg-tmpl"),e);$(".J_bigPicBlock").html(i),$("#goodsPicList").find("li").removeClass("current"),$("#goodsPicList").find("li").eq(t).addClass("current")},o=$("#goodsPicList").find("li").eq(t).find("img").attr("data-src"),i={imgsrc:o};MI.itemUtil.imgLoad(i,e)},showProSlide:function(){var t=this;$(document).on("click","#goodsPicList>li",function(){var e=$(this).index();$(".J_bigPicBlock").html(""),$.proxy(t.changeProSlidCallback(e),t)})},showHeadView:function(){var t=parseInt($("#goodsDetail").offset().top);$("#goodsSubBar").css("top",t),$(window).scroll(function(){var t=$(this).scrollTop(),e=parseInt($("#goodsDetail").offset().top),o=$("#goodsSubBar"),i=$("#goodsSubMenu > ul > li"),a=$(".J_extraContent");if(t>=e-1){o.css("top","0px").addClass("goods-sub-bar-play");for(var n=$(".J_itemBox"),s=0,r=-1;r<n.length;r+=2)if(s=n.eq(r).offset().top-59,-1===r&&(s=n.eq(0).offset().top-59),r!==n.length-2){var d=n.eq(r+2).offset().top-59;if(t>=s&&d>t){-1===r?i.eq(0).addClass("current").siblings().removeClass("current"):i.eq((r+1)/2).addClass("current").siblings().removeClass("current");break}}else if(t>=s){i.eq((r+1)/2).addClass("current").siblings().removeClass("current");break}}else o.css("top","-80px"),o.removeClass("goods-sub-bar-play"),1===a.length?a.is(":visible")?$(".J_originNav > li:eq(0)").addClass("current").siblings().removeClass("current"):$(".J_originNav > li:eq(1)").addClass("current").siblings().removeClass("current"):3===a.length?a.eq(0).is(":visible")?$(".J_originNav > li:eq(0)").addClass("current").siblings().removeClass("current"):!a.eq(0).is(":visible")&&a.eq(1).is(":visible")?$(".J_originNav > li:eq(1)").addClass("current").siblings().removeClass("current"):$(".J_originNav > li:eq(2)").addClass("current").siblings().removeClass("current"):a.is(":visible")?$(".J_originNav > li:eq(0)").addClass("current").siblings().removeClass("current"):$(".J_originNav > li:eq(1)").addClass("current").siblings().removeClass("current")})},getCommentList:function(){var t=this;jiangpeiConfig.closeGoodsCommentList?($("#J_commentTipInfo").html("<p style='text-align:center;'>抢购活动期间，服务器压力山大，评价暂时停止显示</p>"),$("#goodsCommentContent").removeClass("hasContent"),$("#goodsCommentContent").addClass("noContent")):t.commentApi.initCommentList()},getQuestionList:function(){var t=this;jiangpeiConfig.closeGoodsFaq?($("#goodsFaq").hide(),$("#goodsFaqContent").hide()):t.questionApi.initQuestionList()},showImgOnly:function(){var t=null,e=this,o=e.pageConfig,i=function(t){if(0===t.code){if(e.commentApi.comment=t.data,e.commentApi.oriComment=$.extend(!0,{},t.data),0===t.data.total_count)return MI.itemUtil.showErrorModal("暂时还没有带图评价哦~ "),$(".J_showImg").removeClass("current"),!1;var o=5;$("#J_loadCommentMore").hasClass("hide")&&(o=10);var i={amount:o,startIndex:0};e.commentApi.renderSupCommentList(i),e.commentApi.renderTimelineCommentList(o),e.commentApi.setCommemntLikeStatus()}};$("body").on("click",".J_showImg",function(){t=$(this);var e=0;t.hasClass("current")?t.removeClass("current"):(t.addClass("current"),e=1);var a=MI.goodsDetailConfig.commentWwwUrl+"comment/entry/getSummary?goods_id="+o.productId+"&sstart=0&slen=10&astart=0&alen=10&showimg="+e;MI.itemUtil.jsonpCache(a,i)})},refreshPrice:function(){var t={url:MI.goodsDetailConfig.stockUrl+"/item/view?itemid="+goodsConfig.commodityId},e=this,o=e.pageData,i=function(t){if(1===t.code){var e=t.data,i=e.commodity.price_max,a=e.commodity.price_min,n=e.commodity.market_price_max,s=a;i>a?s=a+"~"+i:$(".J_mi_marketPrice").html(parseFloat(n)>parseFloat(s)?n+"元":""),$(".J_mi_goodsPrice").html(s);var r=e.commodity.is_cos;if(r){var d=$(".goods-over-btn").length;if(0===d){$(".goods-add-cart-btn").remove();var l="";l=o.closeSubscribe?MI.cart.stockTmpl():!o.isPackage&&o.defaultGoodsId?MI.cart.registerTmpl(o.subUrl):MI.cart.stockTmpl(),$("#goodsSubBarBtnBox").html(l)}}else{var c=$(".goods-add-cart-btn").length;if(0===c){var m=MI.cart.cartTmpl(),u=doT.template(m);if(!o.nextStep){var g=1,p="",f="",h=$.inArray(goodsConfig.commodityId,MI.GLOBAL_CONFIG.damiaoGoodsId)>=0?!0:!1;goodsConfig.isPackage&&!h?goodsConfig.scenarioId?(p=goodsConfig.commodityId+"-"+goodsConfig.scenarioId+"-"+g,f=MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+p):(p=goodsConfig.commodityId+"/gid/0/c/"+g,f=MI.GLOBAL_CONFIG.cartSite+"/item/batchView/bid/"+p):(p=goodsConfig.defaultGoodsId,f=MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+p),o.nextStep=f,o.addCartGid=p}$("#goodsDetailBtnBox").find(".goods-over-btn").after(u(o)),$("#goodsDetailBtnBox").find(".goods-over-btn").remove();var v=MI.cart.barCartTmpl(),C=doT.template(v);$("#goodsSubBarBtnBox").html(C(o)),goodsConfig.isPackage&&!goodsConfig.defaultGoodsId&&($("#goodsDetailAddCartBtn").removeAttr("id"),$("#goodsSubBarAddCartBtn").removeAttr("id"))}}var _=e.goods.style.list,I=[];if(_){for(var y in _)if(_.hasOwnProperty(y)){var w=_[y];w.size=y,I.push(w)}if(0!==I.length){var b=MI.cart.sizeTmpl(),k=doT.template(b);$("#J_goodsSize").html(k(I))}}}};MI.itemUtil.jsonP(t,i)},judgeClothSize:function(){var t=this;$(document).on("mouseover","#goodsDetailAddCartBtn",function(){if(0===parseInt(goodsConfig.defaultGoodsId)&&0===parseInt(goodsConfig.isPackage)){var t='<div class="goodsDetailInfo">请选择尺码</div>',e=$("#goodsDetailBtnBox").find(".goodsDetailInfo").length;0===e?($("#goodsDetailBtnBox").append(t),$("#goodsDetailBtnBox").find(".goodsDetailInfo").show()):$("#goodsDetailBtnBox").find(".goodsDetailInfo").show(),$(".goods-add-cart-btn").addClass("stopCursor")}else $(".goods-add-cart-btn").removeClass("stopCursor");return!1}).on("mouseout","#goodsDetailAddCartBtn",function(){$("#goodsDetailBtnBox").find(".goodsDetailInfo").remove()}),$(document).on("click",".goods-add-cart-btn",function(){if(0===parseInt(goodsConfig.defaultGoodsId)&&0===parseInt(goodsConfig.isPackage)){var t=$(this).attr("id");return"goodsSubBarAddCartBtn"===t&&MI.itemUtil.showErrorModal("请选择您要购买的商品"+goodsConfig.goodsStyleName),!1}});var e=$("#goodsDetailAddCartBtn").attr("data-gid");0===parseInt(e)&&$(".goods-add-cart-btn").attr("data-disabled","true"),$(document).on("click",".goodsStyle",function(){var e=$(this).hasClass("disabled");if(!e){$(".goods-add-cart-btn").attr("data-disabled","false").removeClass("stopCursor"),$(this).parent().addClass("current").siblings("li").removeClass("current");var o=$(this).attr("data-price"),i=$(this).attr("data-is-cos");goodsConfig.defaultGoodsId=$(this).attr("data-id"),goodsConfig.isCos=i,$(".J_mi_goodsPrice").html(o);var a=$("#goodsDetailAddCartBtn"),n=$("#goodsSubBarAddCartBtn"),s=goodsConfig.needChioce,r=goodsConfig.isPackage,d=0===parseInt(goodsConfig.defaultGoodsId)&&1===parseInt(goodsConfig.isPackage)?goodsConfig.commodityId+"-"+goodsConfig.scenarioId+"-1":goodsConfig.defaultGoodsId,l=function(){return s?MI.GLOBAL_CONFIG.orderSite+"/item/batchView/bid/"+goodsConfig.commodityId+"/gid/0/c/1":r?MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+goodsConfig.commodityId+"-"+goodsConfig.scenarioId+"-1":MI.GLOBAL_CONFIG.cartSite+"/cart/add/"+goodsConfig.defaultGoodsId+"-"+goodsConfig.scenarioId+"-1"},c=l(),m={nextStep:c,addCartGid:d,needChioce:s};if($.extend(t.pageData,m),goodsConfig.isCos)if($(".goods-add-cart-btn").length>0)a.attr("href",c).attr("data-gid",d).attr("data-package",s),n.attr("href",c).attr("data-gid",d).attr("data-package",s);else{var u=MI.cart.cartTmpl(),g=doT.template(u);$("#goodsDetailBtnBox").find(".goods-over-btn").after(g(m)),$("#goodsDetailBtnBox").find(".goods-over-btn").remove();var p=MI.cart.barCartTmpl(),f=doT.template(p);$("#goodsSubBarBtnBox").html(f(m))}else $(".goods-add-cart-btn").length>0&&$(".goods-add-cart-btn").remove(),$(".goods-over-btn").length>0&&$(".goods-over-btn").remove(),$("#goodsSubBarBtnBox").html(MI.cart.stockTmpl());t.loadAddress()}})},is:function(){var t=function(t){var o=$("#goodsDetailAddCartBtn").attr("data-gid");o=o.split("-")[0];var i=MI.GLOBAL_CONFIG.staticSite+"/buySuccess/?pid="+goodsConfig.commodityId+"&gid="+o;1===t.code?location.href=e.pageData.rediectCartSite?MI.GLOBAL_CONFIG.staticSite+"/cart":i:MI.itemUtil.showErrorModal(t.message)},e=this;e.pageData.redirectFlag||MI.bigtapAddCart({obj:"#goodsSubBarAddCartBtn, #goodsDetailAddCartBtn",callback:function(e){t(e)}});var o=function(){var t=$("#goodsDetailAddCartBtn").attr("data-gid"),e=MI.GLOBAL_CONFIG.damiaoSite+"hdinfo/cn",o=$.inArray(t,MI.GLOBAL_CONFIG.damiaoGoodsId)>=0?!0:!1;o&&$.ajax({type:"GET",url:e,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdinfo",timeour:1e4,error:function(){},success:function(e){e.status[t]||(e.status[t]={hdstart:!1,hdstop:!0}),(e.status[t].hdstart===!1&&e.status[t].hdstop===!0||e.status[t].hdstart===!1&&e.status[t].hdstop===!1)&&$("#goodsDetailAddCartBtn, #goodsSubBarAddCartBtn").removeClass("btn-primary").addClass("btn-gray").html("暂时缺货").attr("data-disabled","true"),$("#J_productStatus").addClass("nopro").removeClass("active  noserver soldout").find(".time").html(""),$(".address-info").css("margin-left",0)}})};o()},showStoreBtnStatus:function(){var t=$.cookie("cUserId")||$.cookie("userId"),e=this;if(t&&!jiangpeiConfig.closeFavoriteStatusShow){var o={};o.count=0,o.url=MI.GLOBAL_CONFIG.orderSite+"/favorite/check/id/"+goodsConfig.commodityId,e.storeAjax(o)}},storeAjax:function(t){var e=this,o=function(t,o){if(1===t.code)$("#goodsDetailCollectBtn").attr("data-isfavorite","true").addClass("current"),"del"===o.btype&&$("#goodsDetailCollectBtn").attr("data-isfavorite","false").removeClass("current");else if(-1===t.code)MI.itemUtil.showErrorModal(t.message);else if(-2===t.code&&(o.count++,1===o.count))if($.cookie("userId")){var i=function(){$.proxy(e.storeAjax(o),e)};MI.itemUtil.syncLoginStatus(MI.GLOBAL_CONFIG.orderSite,i)}else MI.itemUtil.rediectLogin()};MI.itemUtil.jsonP(t,o)},changeStoreBtnStatus:function(){var t=this,e={};$(document).on("click","#goodsDetailCollectBtn",function(){var o=$(this).attr("data-isfavorite");e.count=0,"true"===o?(e.btype="del",e.url=MI.GLOBAL_CONFIG.orderSite+"/favorite/drop/id/"+goodsConfig.commodityId):(e.url=MI.GLOBAL_CONFIG.orderSite+"/favorite/add/id/"+goodsConfig.commodityId,e.btype="add",$(".J_redCopy").addClass("redsd")),t.storeAjax(e)})},clickToSpot:function(){var t=this;t.hasLoadLazyMethod=!1,$(".J_commentIcon").on("click",function(){$("#J_commentIcon").click()}),$(".J_questionIcon").on("click",function(){$("#J_questionIcon").click()}),$("body").on("click",".J_scrollHref",function(){t.hasLoadLazyMethod||(t.needLazyMethod(),t.hasLoadLazyMethod=!0);var e=$(this).parent().index(),o=$(".J_extraContent"),i=0;$(this).parent().addClass("current").siblings().removeClass("current"),1===o.length?0===e?(o.show(),i=$(".J_itemBox").eq(0).offset().top-58,$("body,html").animate({scrollTop:i},500)):(o.hide(),i=$(".J_itemBox").eq(0===e?0:2*e-1).offset().top-58,$("body,html").animate({scrollTop:i},500)):3===o.length?0===e?(o.show(),i=$(".J_itemBox").eq(0).offset().top-58,$("body,html").animate({scrollTop:i},500)):1===e?(o.eq(0).hide(),o.eq(1).show(),o.eq(2).show(),i=$(".J_itemBox").eq(0===e?0:2*e-1).offset().top-58,$("body,html").animate({scrollTop:i},500)):(o.hide(),i=$(".J_itemBox").eq(0===e?0:2*e-1).offset().top-58,$("body,html").animate({scrollTop:i},500)):0===e?(o.show(),i=$(".J_itemBox").eq(0).offset().top-58,$("body,html").animate({scrollTop:i},500)):(o.hide(),i=$(".J_itemBox").eq(0===e?0:2*e-1).offset().top-58,$("body,html").animate({scrollTop:i},500))})},renderServicePage:function(){var t=shouhouData[goodsConfig.catId];if(t){var e=MI.goodsDetailUtil.dotmpl($("#service-tmpl"),t);$("#J_serviceCon").html(e)}else $("#goodsService").hide(),$(".goods-detail-service-block").hide()},scorllCommentPic:function(){MI.itemUtil.scrollLeftRight()},clickBatch:function(){var t=this;$("body").on("click",".J_batchBtn",function(){if($(this).hasClass("disabled"))return!1;var e=$(this).attr("data-id");if($(this).siblings("li").removeClass("current"),$(this).addClass("current"),$(".goodsBatchNextStep").remove(),"none"===e)return $(".J_goodsDetail").removeClass("showBatchLayer"),!1;var o=t.pageData.recommend_package,i={};o&&(i=o[e]);var a=MI.goodsDetailUtil.dotmpl($("#batch-tmpl"),i);$(".J_goodsBatchImg").html(a),$(".J_goodsDetail").addClass("showBatchLayer");var n=$("#goodsDetailBtnBox").find(".goods-add-cart-btn").length;if(0===n)return!1;var s='<div class="goodsBatchNextStep" data-pkid = "'+e+'">下一步</div>';$("#goodsDetailBtnBox").append(s),$("#goodsSubBarBtnBox").append(s),$("#goodsSubBarBtnBox").find(".goodsBatchNextStep").attr("id","J_subGoodsBatchNextStep")}),$(document).on("mouseover",".goodsBatchNextStep",function(){if(0===parseInt(goodsConfig.defaultGoodsId)&&0===parseInt(goodsConfig.isPackage)){var t='<div class="goodsDetailInfo">请选择尺码</div>',e=$("#goodsDetailBtnBox").find(".goodsDetailInfo").length;0===e?($("#goodsDetailBtnBox").append(t),$("#goodsDetailBtnBox").find(".goodsDetailInfo").show()):$("#goodsDetailBtnBox").find(".goodsDetailInfo").show(),$(".goodsBatchNextStep").addClass("stopCursor")}else $(".goodsBatchNextStep").removeClass("stopCursor");return!1}).on("mouseout",".goodsBatchNextStep",function(){$("#goodsDetailBtnBox").find(".goodsDetailInfo").remove()}),$(document).on("click",".goodsBatchNextStep",function(){if(0===parseInt(goodsConfig.defaultGoodsId)&&0===parseInt(goodsConfig.isPackage)){var t=$(this).attr("id");return"J_subGoodsBatchNextStep"===t&&MI.itemUtil.showErrorModal("请选择您要购买的商品"+goodsConfig.goodsStyleName),!1}var e=$(this).attr("data-pkid"),o=goodsConfig.defaultGoodsId;location.href=MI.GLOBAL_CONFIG.cartSite+"/item/suitRecommend/gid/"+o+"/sid/"+e})},clickShowBigImg:function(){var t=this;t.commentApi.clickShowBigImg()},clickItemImg:function(){var t=this,e={},o=0;t.canSet=!0,$("body").on("click",".J_bigPicBlock",function(){var i=$(window).height();if(600>i)return!1;$("#goodsPicZoomBlock").remove();var a=[],n=0;$("#goodsPicList").find("li").each(function(t){var e=$(this).find("img");$(this).hasClass("current")&&(n=t);var o={sml:e.attr("src"),big:e.attr("data-src-b"),bigWid:800};if(900>i){var s=100,r=i-s;o.big=o.big.replace("800x800",r+"x"+r),o.bigWid=r}a.push(o)}),e.imgArr=a,e.curIndex=n;var s=$("#itemBigImg-tmpl").html(),r=doT.template(s);$("body").append(r(e)),900>i?($("#J_zoomBigBlock").addClass("suoHei"),$(".J_itemZoomSmlList").addClass("suoHei")):($("#J_zoomBigBlock").removeClass("suoHei"),$(".J_itemZoomSmlList").removeClass("suoHei")),t.ciiInitEle(),t.canSet=!1;var d=function(){$("#J_zoomBigBlock").addClass("changeDivZoom")},l=function(){$("#goodsPicZoomBlock").addClass("transAll"),$("#goodsPicZoomBlock").removeClass("zoomImgInit-b"),$("#J_zoomBigBlock").removeAttr("style"),$("#J_zoomBigBlock").find("img").removeAttr("style");var t=e.imgArr[e.curIndex].bigWid;$("#J_zoomBigBlock").find("img").css("margin-left","-"+t/2+"px").css("width",t+"px").css("height",t+"px"),$("#J_zoomBigBlock").find(".img").css("margin-left","-"+t/2+"px").css("width",t+"px").css("height",t+"px"),setTimeout(d,400)},c=function(){$("#goodsPicZoomBlock").removeClass("zoomImgInit-a"),setTimeout(l,100)},m={imgsrc:e.imgArr[e.curIndex].big};MI.itemUtil.imgLoad(m,c),o=e.curIndex;var u=$("#goodsPicList").find("li").length,g=80*u,p=-(80*u)/2+5;$(".J_itemZoomSmlList").css("width",g).css("margin-left",p+"px")}),$("body").on("click",".J_exitItemBig",function(){t.canSet=!0;var e=function(){$("#goodsPicZoomBlock").remove()},o=function(){$("#goodsPicZoomBlock").addClass("zoomImgInit-a"),setTimeout(e,300)},i=function(){t.initSetEle(),$("#goodsPicZoomBlock").addClass("zoomImgInit-b"),setTimeout(o,800)};setTimeout(i,100),$("#J_zoomBigBlock").removeClass("changeDivZoom")});var i=function(t){o=t;var i=e.imgArr.length;0===t?($(".J_itemZoomLeft").addClass("dective"),$(".J_itemZoomRight").removeClass("dective")):t===i-1?($(".J_itemZoomLeft").removeClass("dective"),$(".J_itemZoomRight").addClass("dective")):($(".J_itemZoomLeft").removeClass("dective"),$(".J_itemZoomRight").removeClass("dective")),$("#J_zoomBigBlock").addClass("loaded");var a=function(e){$("#J_zoomBigBlock").find(".img").css("background-image","url("+e.img.src+")"),$("#J_zoomBigBlock").find("img").attr("src",e.img.src),$("#J_zoomBigBlock").removeClass("loaded"),$(".J_itemZoomSmlList").find("li").removeClass("current"),$(".J_itemZoomSmlList").find("li").eq(t).addClass("current")},n={imgsrc:e.imgArr[t].big};MI.itemUtil.imgLoad(n,a),$("#goodsPicList").find("li").eq(t).click()};$("body").on("click",".J_itemZoomLeft",function(){return o--,0>o?(o=0,!1):void i(o)}),$("body").on("click",".J_itemZoomRight",function(){return o++,o>e.imgArr.length-1?(o=e.imgArr.length-1,!1):void i(o)}),$("body").on("click",".J_itemZoomSmlList > li",function(){var t=$(this).index();i(t)})},ciiInitEle:function(){var t=this,e=function(){t.initSetEle()};e(),$(window).resize(function(){e()}),document.addEventListener&&document.addEventListener("DOMMouseScroll",function(){e()},!1),window.onmousewheel=document.onmousewheel=function(){e()}},lazyloadDescImg:function(t){var e=-1,o=t.find(".detailBlock"),i=o.find("img").length,a=this,n=function(t){if(t.isError)return l(),!1;var i=t.img,a=i.height,n=o.find("img").eq(e).attr("data-src");o.find("img").eq(e).attr("src",n),r=a+r,l()},s=parseInt($(window).height()),r=t.offset().top,d=function(){a.hasLoadLazyMethod||(a.needLazyMethod(),a.hasLoadLazyMethod=!0)},l=function(){var t=document.documentElement.scrollTop||document.body.scrollTop,a=parseInt(t)+2*s;if(c=r>a?!0:!1,e+=1,e>i-1)return c=!1,d(),!1;var m=o.find("img").eq(e),u=m.attr("data-src");if(!u)return l(),!1;var g={imgsrc:u};MI.itemUtil.imgLoad(g,n)},c=!1;l(),$(window).on("scroll.imgload",function(){c&&l()})},initSetEle:function(){var t=this;if(t.canSet){var e=$(window).height(),o=$(document).scrollTop(),i=$(".J_bigPicBlock"),a=i.offset().top-o,n=i.offset().left,s=i.find("img").width(),r=i.find("img").height();$("#goodsPicZoomBlock").css("height",e),$("#J_zoomBigBlock").find("img").css("width",s).css("height",r),$("#J_zoomBigBlock").find("img").css("top",a).css("left",n).css("margin-left","0px").css("margin-top","0px")}},descriptionInteractSet:function(t){function e(t,e,o){return"<iframe height="+o+" width="+e+' src="//hd.mi.com/f/zt/hd/miplayer2/index.html?vurl='+t+"&width="+e+"&height="+o+'&auto=1" frameborder=0 allowfullscreen></iframe>'}t.find(".huandengpian").each(function(){var t=!1;$(this).attr("pager")&&(t=!0);var e=[];$(this).find("img").each(function(){e.push($(this).attr("src")?$(this).attr("src"):$(this).attr("data-src"))});var o=MI.goodsDetailUtil.dotmpl($("#carousel-tmpl"),e);$(this).replaceWith(o);var i=$(".J_itemCarousel").find("img").eq(0).attr("src");i||(i=$(".J_itemCarousel").find("img").eq(0).attr("data-src"));var a={imgsrc:i},n=function(e){var o=e.img.height,i=$(".J_itemCarousel");i.find("li").css("height",o).show(),i.carousel({controlsClass:"xm-controls-block-middle",pager:t,onLoad:function(t){t.closest(".xm-carousel-container").find(".pager").each(function(t){$(this).addClass("pager-"+t)})},itemPerSlide:1})};MI.itemUtil.imgLoad(a,n)}),t.find(".J_itemVideo").each(function(){$(this).click(function(){var t=$("#J_modalVideo .modal-bd");return t.html(""),t.append(e($(this).attr("href"),880,536)),$("#J_modalVideo").modal("show").on("hidden",function(){t.html("")}),!1})})},getGoodsDetail:function(){var t=this,e="//"+goodsConfig.apiOrderURL+"/product/boxInfo";$.ajax({url:e,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,data:{id:goodsConfig.productId},success:function(e){var o=e.data.desc_tabs_view,i="",a="",n="";if(t.afterSaleInfo(e.data.commodity_page.after_sale_info||{}),0===o.length)return i+='<div class="goods-detail-nav-name-block J_extraContent"><div class="container main-block"><div class="border-line"></div><h2 class="nav-name">详情描述</h2></div></div>',i+='<div class="goods-detail-comment noContent J_extraContent"><div class="goods-detail-null-content"><div class="container"><h3 style="margin-top: 95px">该商品暂时还没有详情描述</h3></div></div></div>',a='<li class="current"><a href="javascript:void(0)" class="J_scrollHref">详情描述</a></li>',$(".J_detailNav").prepend(a),$(i).insertBefore($("#goodsComment")),t.showHeadView(),t.clickToSpot(),t.changeSlide(e.data),t.needLazyMethod(),!1;var s=o[0].tab_content;if(1===o.length)i+=t.handle(s),$("#goodsDesc .detailBlock").html(i),a='<li class="current"><a href="javascript:void(0)" class="J_scrollHref">'+o[0].name+"</a></li>",$(".J_detailNav").prepend(a);else{i+=t.handle(s),$("#goodsDesc .detailBlock").html(i);for(var r=1;r<o.length;r++)n+='<div class="goods-detail-nav-name-block J_itemBox J_extraContent"><div class="container main-block"><div class="border-line"></div><h2 class="nav-name">'+o[r].name+"</h2></div></div>",n+='<div class="goods-detail-desc J_itemBox J_extraContent"><div class="container"><div class="shape-container" ><div class="detailBlock">',n+=t.handle(o[r].tab_content),n+="</div></div></div></div>";for(var d=0;d<o.length;d++)a+=0===d?'<li class="current"><a href="javascript:void(0)" class="J_scrollHref">'+o[0].name+"</a></li>":'<li><a href="javascript:void(0)" class="J_scrollHref">'+o[d].name+"</a></li>";$(n).insertBefore($("#goodsComment")),$(".J_detailNav").prepend(a)}t.showHeadView(),t.clickToSpot(),$(".J_extraContent").each(function(){t.lazyloadDescImg($(this)),t.descriptionInteractSet($(this))}),t.changeSlide(e.data)},error:function(){console.log("接口出错，请刷新重试！")}})},afterSaleInfo:function(t){if(t&&t[goodsConfig.defaultGoodsId]){var e=t[goodsConfig.defaultGoodsId]||null,i=o(17);e&&(e.list&&$("#J_policy").html(i(e.list)),e.company_info&&($("#J_aftersaleCompany").html(e.company_info.name).attr("type",e.company_info.business_type).attr("desc",JSON.stringify(e.company_info.desc)),$("#J_aftersaleCompany").on("click.showCompanyInfo",function(){var t=JSON.parse($(this).attr("desc")),e=$(this).attr("type");"2"===e&&$("#J_aftersaleModal").modal("show").find(".modal-con").html(t.desc.replace(/ /g,"&nbsp;").replace(/\n/g,"</br />")).end().find(".title").html(t.title)})))}},changeSlide:function(t){for(var e=[],o="",i=t.commodity_page.goods_info,a=0;a<i.length;a++)if(parseInt(goodsConfig.commodityId)===i[a].commodity_id){e=i[a].img_800_pms;break}e.length>5&&(e=e.slice(0,5));for(var n=0;n<e.length;n++)o+=0===n?'<li class="current"><img src="'+e[n]+'" data-src="'+e[n]+'" data-src-b="'+e[n]+'"></li>':'<li><img src="'+e[n]+'" data-src="'+e[n]+'" data-src-b="'+e[n]+'"></li>';$("#goodsPicList").html(o),$("#J_BigPic").attr("src",e[0]),$("#goodsName").html(t.commodity_page.product_info.name)},handle:function(t){for(var e="",o=0;o<t.length;o++)if("plain_view"===t[o].view_type)""!==t[o].plain_view.link_url?(""!==t[o].plain_view.link_title&&""!==t[o].plain_view.title&&(e+='<div class="text-title">'+t[o].plain_view.title+'<a href="'+t[o].plain_view.link_url+'" target="_blank">'+t[o].plain_view.link_title+'<i class="iconfont"></i></a></div>'),
e+='<a href="'+t[o].plain_view.link_url+'" target="_blank"><img data-src="'+t[o].plain_view.img+'" /></a>'):e+='<div><img data-src="'+t[o].plain_view.img+'" /></div>';else if("gallery_view"===t[o].view_type){e+='<div class="huandengpian">';for(var i=0;i<t[o].gallery_view.length;i++)e+='<img data-src="'+t[o].gallery_view[i]+'" />';e+="</div>"}else if("video_view"===t[o].view_type)e+='<div class="J_itemVideo" href="'+t[o].video_view.video_url+'"><img data-src="'+t[o].video_view.img+'" /></div>';else if("text_view"===t[o].view_type){var a=t[o].text_view.desc.replace("\n","<br>").replace("#","");e+='<a target="_blank" href="'+t[o].text_view.link_url+'" class="goods-text">'+a+"</a>"}return e}},$(function(){MI.goodsDetail.init(),a(),n(),$(window).resize(function(){i()})})},function(t,e,o){MI.namespace("goodsCommentTmpl, itemUtil"),MI.goodsCommentTmpl=o(3),MI.itemUtil=o(4),MI.pagenav=o(5);var i=function(t){var e=this;e.randomColorIndex=[];for(var o=1;11>o;o++)e.randomColorIndex.push(o);e.option=t,MI.itemUtil.trimInit()};i.prototype={constructor:i,initCommentList:function(t){var e=this,o=e.option.getCommenturlHead+"comment/entry/getSummary?goods_id="+e.option.proId+"&sstart=0&slen=10&astart=0&alen=10",i=function(t){if(0===t.code){e.comment=t.data,e.oriComment=$.extend(!0,{},t.data);var o=t.data.total_count;o>0?($("#goodsCommentContent").removeClass("noContent"),$("#goodsCommentContent").addClass("hasContent")):($("#goodsCommentContent").removeClass("hasContent"),$("#goodsCommentContent").addClass("noContent")),$("#J_loadCommentMore").attr("data-amount",o),$.proxy(e.renderCommentAftergetAll(),e),t.data.support_comments.length&&$.proxy(e.setCommemntLikeStatus(),e)}};t?o=e.option.getCommenturlHead+"comment/entry/getSummary?goods_id="+e.option.proId+"&sstart=0&slen=0&astart=0&alen=0":(e.moreCommentList(),e.answerToComment(),e.clickLikeBtn(),e.clickLikeCustomService(),e.keyboardControl()),MI.itemUtil.jsonpCache(o,i)},keyboardControl:function(){document.onkeydown=function(t){var e=t||window.event,o=$("body").hasClass("showZoomImg");e&&27===e.keyCode&&o&&$("#JimageModal").modal("hide"),e&&39===e.keyCode&&o&&$(".J_zoomright").click(),e&&37===e.keyCode&&o&&$(".J_zoomLeft").click()}},renderCommentAftergetAll:function(){var t=this;if(t.option.recommendBlock&&t.renderRecommentList(),t.option.supCommentBlock){var e={amount:5,startIndex:0};t.renderSupCommentList(e)}t.option.timelineCommentBlock&&t.renderTimelineCommentList()},getLikeStatusCallback:function(t){var e=this,o=function(t){e.likeStatus=t.data,$.proxy(e.renderSupCommentLikeStatus(),e),$.proxy(e.renderNewCommentLikeStatus(),e),$.proxy(e.renderDetailCommentLikeStatus(),e)},i=function(t,i){if(0===t.code)o(t);else if(-1001===t.code&&(i.count++,1===i.count&&($.cookie("cUserId")||$.cookie("userId")))){var a=function(){$.proxy(e.getLikeStatusCallback(i),e)};MI.itemUtil.syncLoginStatus(e.option.answerCommentUrlHead,a)}};MI.itemUtil.jsonP(t,i)},renderDetailCommentLikeStatus:function(){var t=this,e=t.likeStatus;if(t.option.detailCommentBlock){var o=t.option.detailCommentBlock,i=o.attr("data-id");e&&e[i]&&(e[i].customer&&o.find(".J_csLike").addClass("current"),e[i].up&&o.find(".J_hasHelp").addClass("current"),e[i].down&&o.find(".J_noHelp").addClass("current"))}},renderSupCommentLikeStatus:function(){var t=this,e=t.likeStatus;if(t.option.supCommentBlock&&e){var o=function(t){var e=parseInt(t.find(".amount").html());0===e&&t.find(".amount").html(1)},i=function(t){var e=parseInt(t.find(".amount").html());0===e&&t.find(".amount").html("&nbsp;")};t.option.supCommentBlock.find("li").each(function(){var t=$(this),a=t.attr("data-id");e[a]&&(e[a].customer?(t.find(".J_csLike").addClass("current"),o(t.find(".J_csLike"))):i(t.find(".J_csLike")),e[a].up?(t.find(".J_hasHelp").addClass("current"),o(t.find(".J_hasHelp"))):i(t.find(".J_hasHelp")),e[a].down?(t.find(".J_noHelp").addClass("current"),o(t.find(".J_noHelp"))):i(t.find(".J_noHelp")))})}},renderNewCommentLikeStatus:function(){var t=this,e=t.likeStatus;if(t.option.timelineCommentBlock&&e){var o=function(t){var e=parseInt(t.find(".amount").html());0===e&&t.find(".amount").html(1)},i=function(t){var e=parseInt(t.find(".amount").html());0===e&&t.find(".amount").html("")};t.option.timelineCommentBlock.find("li").each(function(){var t=$(this),a=t.attr("data-id");e[a]&&(e[a].up?(t.find(".J_hasHelp").addClass("current"),o(t.find(".J_hasHelp"))):i(t.find(".J_hasHelp")))})}},setCommemntLikeStatus:function(){var t=this,e=t.oriComment,o=[];for(var i in e.support_comments)if(e.support_comments.hasOwnProperty(i)){var a=e.support_comments[i].comment_id;o.push(a)}for(var n in e.addtime_comments)if(e.addtime_comments.hasOwnProperty(n)){var s=e.addtime_comments[n].comment_id;o.push(s)}for(var r in e.comments)if(e.comments.hasOwnProperty(r)){var d=e.comments[r].comment_id;o.push(d)}var l=o.join(","),c={count:0,url:t.option.answerCommentUrlHead+"/comment/entry/checkUp?comment_ids="+l};t.getLikeStatusCallback(c)},renderRecommentList:function(){var t=this,e=MI.goodsCommentTmpl.recommendTmpl(),o=doT.template(e),i=t.comment.recommand_comments,a=t.randomColorIndex.sort(function(){return.5-Math.random()});for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];s.randomIndex=a[n],s.user_avatar||(s.user_avatar=MI.itemUtil.randomHeadImg())}t.option.recommendBlock.html(o(t.comment))},renderSupCommentList:function(t){var e=this,o=t.amount,i=t.startIndex,a=t.appendFlag,n=e.comment.support_comments||e.comment.comments;if(n&&n.length){var s=e.randomColorIndex.sort(function(){return.5-Math.random()}),r=["失望","一般","满意","喜欢","超爱"],d=["e613","e61f","e60e","e619","e604"],l=function(t){for(var e in t)if(t.hasOwnProperty(e)){var o=t[e];o.user_avatar||(o.user_avatar=MI.itemUtil.randomHeadImg(),o.reply_content=MI.itemUtil.dataToHtml(o.reply_content))}};for(var c in n)if(n.hasOwnProperty(c)){var m=n[c];m.check_time=parseInt(m.check_time);var u=MI.itemUtil.calShowTime(m.check_time||m.add_timestamp,e.comment.server_time);m.showTime=u,m.randomIndex=s[c],m.loveText=r[parseInt(m.total_grade)-1],m.loveIcon=d[parseInt(m.total_grade)-1],m.user_avatar||(m.user_avatar=MI.itemUtil.randomHeadImg()),m.comment_content=MI.itemUtil.dataToHtml(m.comment_content),l(m.user_replys)}var g=[];if(n.length>o){$("#J_loadCommentMore").removeClass("hide");for(var p=0;o>p;p++){var f=n.shift();g.push(f)}}else g=n.slice(),e.comment.support_comments=[],e.comment.comments=[];var h=MI.goodsCommentTmpl.supCommentTmpl(),v=doT.template(h);a?e.option.supCommentBlock.append(v(g)):(i=0,e.option.supCommentBlock.html(v(g)));var C=g.length;e.reRenderImgSizeInComment(e.option.supCommentBlock,i,C)}},reRenderImgSizeInComment:function(t,e,o){for(var i=function(e){var o=e.i,i=e.b,a=e.img,n=t.find(".J_commentContent").eq(o),s=n.find(".commentImg").eq(i),r=s.attr("data-src"),d=s.parent().width(),l=parseInt(a.width),c=parseInt(a.height);if(l>c){s.css({height:d+"px"});var m=l*d/c;s.css({marginLeft:"-"+(m-d)/2+"px"})}else{s.css({width:d+"px"});var u=c*d/l;s.css({marginTop:"-"+(u-d)/2+"px"})}s.attr("src",r),s.attr("data-width",l),s.attr("data-height",c),s.parent().addClass("showimg")},a=function(t,e){e.find(".commentImg").each(function(e){var o=$(this).attr("data-src"),a={i:t,b:e,imgsrc:o};MI.itemUtil.imgLoad(a,i)})},n=e;e+o>n;n++){var s=t.find(".J_commentContent").eq(n);a(n,s)}},renderTimelineCommentList:function(t){var e=this;t||(t=5);var o=e.comment.addtime_comments;if(o){var i=e.randomColorIndex.sort(function(){return.5-Math.random()});for(var a in o)if(o.hasOwnProperty(a)){var n=o[a],s=MI.itemUtil.calShowTime(n.check_time,e.comment.server_time);n.showTime=s,n.randomIndex=i[a]}var r=[];if(o.length>t){$("#J_loadCommentMore").removeClass("hide");for(var d=0;t>d;d++){var l=o.shift();r.push(l)}}else r=o.slice();var c=MI.goodsCommentTmpl.timelineCommentTmpl(),m=doT.template(c);e.option.timelineCommentBlock.html(m(r));var u=r.length;e.reRenderImgSizeInComment(e.option.timelineCommentBlock,0,u)}},moreCommentList:function(){var t=this,e=function(){var e=t.comment.addtime_comments;if(e.length>0){var o=MI.goodsCommentTmpl.timelineCommentTmpl(),i=doT.template(o);t.option.timelineCommentBlock.append(i(e)),t.reRenderImgSizeInComment(t.option.timelineCommentBlock,5,e.length)}var a=t.comment.support_comments;if(a.length>0){var n=MI.goodsCommentTmpl.supCommentTmpl(),s=doT.template(n);t.option.supCommentBlock.append(s(a)),t.reRenderImgSizeInComment(t.option.supCommentBlock,5,a.length)}},o=function(){$.proxy(t.renderSupCommentLikeStatus(),t),$.proxy(t.renderNewCommentLikeStatus(),t)};$("body").on("click","#J_loadCommentMore",function(){e(),o(),$("#J_loadCommentMore").addClass("hide");var t=$(this).attr("data-amount");parseInt(t)>10&&$("#J_loadMoreHref").removeClass("hide")})},answerToCommentCallback:function(t){var e=this,o=function(t,o){if(0===t.code)MI.itemUtil.showErrorModal("发表成功，请等待审核"),o.recover();else if(-1001===t.code){if(o.count++,1===o.count)if($.cookie("cUserId")||$.cookie("userId")){var i=function(){$.proxy(e.answerToCommentCallback(o),e)};MI.itemUtil.syncLoginStatus(e.option.answerCommentUrlHead,i)}else MI.itemUtil.rediectLogin()}else MI.itemUtil.showErrorModal(t.description)};MI.itemUtil.jsonP(t,o)},answerToComment:function(){var t=this,e=null;$("body").on("click",".J_commentAnswerBtn",function(){e=$(this).prev("input");var o=e.val().trim();if(""===o)return MI.itemUtil.showErrorModal("不能为空"),!1;if(o.length>140)return MI.itemUtil.showErrorModal("字数不能超过140"),!1;var i=MI.itemUtil.revertStr(o),a=$.cookie("userId");if(!a)return MI.itemUtil.rediectLogin(),!1;var n=$(this).attr("data-commentId"),s=t.option.answerCommentUrlHead+"/comment/entry/reply?comment_id="+n+"&parent_id=0&content="+i+"&user_id="+a,r={url:s,count:0,recover:function(){e.val(""),e.parent().parent().removeClass("showIn")}};return t.answerToCommentCallback(r),!1}),$("body").on("focus",".J_commentAnswerInput",function(){var t=$(this);t.parent().parent().addClass("showIn")})},clickLikeBtn:function(){var t=this,e=function(e,a){if(0===e.code){var n=i.parent(),s=0;s=parseInt(n.find(".J_hasHelp").children(".amount").html()),s||(s=0),e.data.up?n.find(".J_hasHelp").addClass("current"):n.find(".J_hasHelp").removeClass("current"),s+=e.data.up_num,0>=s&&(s="&nbsp;"),n.find(".J_hasHelp").children(".amount").html(s);var r=0;r=parseInt(n.find(".J_noHelp").children(".amount").html()),r||(r=0),e.data.down?n.find(".J_noHelp").addClass("current"):n.find(".J_noHelp").removeClass("current"),r+=e.data.down_num,0>=r&&(r="&nbsp;"),n.find(".J_noHelp").children(".amount").html(r)}else if(-1001===e.code&&(a.count++,1===a.count))if($.cookie("cUserId")||$.cookie("userId")){var d=function(){$.proxy(o(a),t)};MI.itemUtil.syncLoginStatus(t.option.answerCommentUrlHead,d)}else MI.itemUtil.rediectLogin()},o=function(t){MI.itemUtil.jsonP(t,e)},i=null;$("body").on("click",".J_hasHelp",function(){i=$(this);var e=$(this).attr("data-commentid"),a=t.option.answerCommentUrlHead+"/comment/entry/up?comment_id="+e,n={count:0,url:a};o(n)}),$("body").on("click",".J_noHelp",function(){i=$(this);var e=$(this).attr("data-commentid"),a=t.option.answerCommentUrlHead+"/comment/entry/down?comment_id="+e,n={count:0,url:a};o(n)})},clickLikeCustomService:function(){var t=null,e=this,o=function(o,a){if(0===o.code){var n=t.find(".amount").html();n||(n=0),n=parseInt(n),o.data.up?(n++,t.addClass("current")):(n--,t.removeClass("current")),0>n&&(n=0),t.find(".amount").html(n)}else if(-1001===o.code&&(a.count++,1===a.count))if($.cookie("cUserId")||$.cookie("userId")){var s=function(){$.proxy(i(a),e)};MI.itemUtil.syncLoginStatus(e.option.answerCommentUrlHead,s)}else MI.itemUtil.rediectLogin()},i=function(t){MI.itemUtil.jsonP(t,o)};$("body").on("click",".J_csLike",function(){t=$(this);var o=$(this).attr("data-commentid"),a=e.option.answerCommentUrlHead+"/comment/entry/upCustomer?comment_id="+o,n={count:0,url:a};i(n)})},showImgOnly:function(){var t=this,e=null,o=function(t){var e=this;if(0===t.code){e.comment=t.data,e.oriComment=$.extend(!0,{},t.data);var o=t.data.total_count;if(0===parseInt(o))return MI.itemUtil.showErrorModal("暂时还没有带图评价哦~ "),$(".J_showImg").removeClass("current"),!1;$("#J_loadCommentMore").attr("data-amount",o);var i=10*(t.data.page_current-1),a={amount:10,startIndex:i};e.renderSupCommentList(a),e.setCommemntLikeStatus(),t.data.page_total>1?MI.pagenav($("#J_commentPagenav"),t.data.page_total,t.data.page_current):$("#J_commentPagenav").html("")}};$("body").on("click",".J_showImg",function(){e=$(this);var i=0;e.hasClass("current")?e.removeClass("current"):(e.addClass("current"),i=1);var a=10,n=1,s=1;$(".J_commentOrder").find("a").each(function(){$(this).hasClass("current")&&(s=$(this).attr("data-order"))});var r=MI.goodsDetailConfig.commentOrderUrl+"/comment/entry/getList?goods_id="+t.option.proId+"&pagesize="+a+"&pageindex="+n+"&orderby="+s+"&showimg="+i;MI.itemUtil.jsonpCache(r,$.proxy(o,t))})},clickShowBigImg:function(){var t=MI.goodsCommentTmpl.zoomTmplDiv();$("body").append(t),$("#JimageModal").on("hide.bs.modal",function(){$("body").removeClass("showZoomImg")});var e=function(t){var e=t.width,o=t.height,i=800,a=450,n="";if(i>e&&a>o){var s=(a-o)/2;n="margin-top:"+s+"px"}else{var r=parseInt(i*o/e);if(a>r){var d=(a-r)/2;n="width:"+i+"px;margin-top:"+d+"px"}else n="height:"+a+"px"}return n},o={};$("body").on("click",".J_canZoomImg",function(){if(!$(this).hasClass("showimg"))return!1;var t=$(this).find("img").attr("src"),i=$(this).parent(),n=i.find("img"),s=[],r=0;o.curSrc=t,o.width=$(this).find("img").attr("data-width"),o.height=$(this).find("img").attr("data-height"),a=0,o.cssStr=e(o),n.each(function(e){var o=$(this).attr("src");o===t&&(r=e);var i=$(this).attr("data-width"),a=$(this).attr("data-height"),n={src:o,width:i,height:a},d="",l=60;d=parseInt(i)>parseInt(a)?"height:"+l+"px":"width:"+l+"px",n.cssStr=d,s.push(n)}),o.curIndex=r,o.smlArr=s;var d=s.length,l=74*d+2;o.smlNavCss="width:"+l+"px";var c=MI.goodsCommentTmpl.zoomImgTmpl(),m=doT.template(c);$("#JimageModal").html(m(o)),$("#JimageModal").modal("show"),$("body").addClass("showZoomImg")});var i=function(t){var o=$(".J_zoomNav").attr("data-amount");0===t?($(".J_zoomLeft").addClass("dective"),$(".J_zoomright").removeClass("dective")):t===parseInt(o)-1?($(".J_zoomLeft").removeClass("dective"),$(".J_zoomright").addClass("dective")):($(".J_zoomright").removeClass("dective"),$(".J_zoomLeft").removeClass("dective")),a=0;var i=$("#JimageModal").hasClass("cantrans");i&&$("#JimageModal").removeClass("cantrans");var n=$(".J_zoomSmlImg").eq(t);n.siblings("li").removeClass("current"),n.addClass("current"),$(".J_zoomNav").attr("data-index",t);var s=n.find("img").attr("data-width"),r=n.find("img").attr("data-height"),d=n.find("img").attr("src"),l={width:s,height:r},c=e(l),m=$(".J_zoomBigImg").width(),u=$(".J_zoomBigImg").height();$(".J_zoomImgContainer").find(".img").css("width",m).css("height",u).css("margin-left","-"+m/2+"px").css("margin-top","-"+u/2+"px"),$(".J_zoomBigImg").fadeOut(200);var g=function(){$(".J_zoomBigImg").attr("src",d),$(".J_zoomBigImg").attr("style",c);var t=$(".J_zoomBigImg").width(),e=$(".J_zoomBigImg").height();$(".J_zoomImgContainer").find(".img").css("width",t).css("height",e).css("margin-left","-"+t/2+"px").css("margin-top","-"+e/2+"px");var o=function(){$(".J_zoomImgContainer").removeClass("loaded"),$(".J_zoomBigImg").fadeIn(500)};setTimeout(o,400)};$(".J_zoomImgContainer").addClass("loaded"),setTimeout(g,200);var p=function(){i&&$("#JimageModal").addClass("cantrans")};setTimeout(p,200)};$("body").on("click",".J_zoomSmlImg",function(){var t=$(this).index();i(t)}),$("body").on("click",".J_zoomLeft",function(){var t=$(".J_zoomNav").attr("data-index");t--,0>t||i(t)}),$("body").on("click",".J_zoomright",function(){var t=$(".J_zoomNav").attr("data-index");t++;var e=$(".J_zoomNav").attr("data-amount");t>e-1||i(t)});var a=0,n=MI.itemUtil.supportCss3("transition");if(n){$("#JimageModal").addClass("canRotate"),$("#JimageModal").addClass("cantrans");var s=function(t,e){t.style.webkitTransform=e,t.style.MozTransform=e,t.style.msTransform=e,t.style.OTransform=e,t.style.transform=e},r=function(t){var e=90*t,o=$(".J_zoomBigImgBlock").find("img")[0];s(o,"rotate("+e+"deg)")};$("body").on("click",".J_rotateLeft",function(){a--,r(a)}),$("body").on("click",".J_rotateRight",function(){a++,r(a)})}}},t.exports=i},function(t,e){var o={recommendTmpl:function(){var t=multiline(function(){/*!@tpl
	    <div class="container" >
	      <ul class='main-block'>
	         <li class='percent'>
	             <div class="per-num">
	                 <i>{{=it.satisfy_rate}}</i>%
	             </div>
	             <div class="per-title">
	                 购买后满意
	             </div>
	             <div class="per-amount">
	                 <i>{{=it.total_count}}</i>名用户投票
	             </div>
	         </li>
	         {{~it.recommand_comments:com:index}}
	         <li class="item-rainbow-{{=com.randomIndex}} groom-content">
	             <dl>
	                 <dt>
	                     <div class="groom-content-userImage">
	                         <img src="{{=com.user_avatar}}" alt="">
	                     </div>
	                     <div class="groom-content-userName">{{=com.user_name}}</div>
	                     <div class="groom-content-commentNum">{{=com.similar_count}}人有相似评价</div>
	                 </dt>
	                 <dd>
	                   <i class='iconfont'>&#xe625;</i> {{=com.content}}
	                 </dd>
	             </dl>
	         </li>
	         {{~}}

	     </ul>
	    </div>
	  */
console.log()});return t},supCommentTmpl:function(){var t=multiline(function(){/*!@tpl
	      {{~it: comt: index}}
	       <li class='item-rainbow-{{=comt.randomIndex}}' data-id='{{=comt.comment_id}}'>
	           <div class="user-image">
	               <img src="{{=comt.user_avatar}}" alt="">
	           </div>
	           <div class="user-emoj">
	               {{=comt.loveText}}<i class="iconfont">&#x{{=comt.loveIcon}};</i>
	           </div>
	           <div class="user-name-info">
	               <span class="user-name">
	                {{=comt.user_name}}
	               </span>
	               <span class="user-time">{{=comt.showTime}}</span>
	               <span class="pro-info">{{=comt.spec_value}}</span>
	           </div>
	           <div class="user-hand-block">
	               <a href="javascript:void(0);" data-commentid='{{=comt.comment_id}}'
	               class='J_hasHelp {{?comt.up_status}}current{{?}}'>
	               <i class='iconfont'>&#xe60f;</i>赞&nbsp;<span class='amount'>
	                {{=parseInt(comt.up_num)}}</span></a>
	           </div>
	            <dl class='user-comment'>
	               <dt class='user-comment-content J_commentContent' >
	                   <p class="content-detail">
	                   <a href='{{=MI.GLOBAL_CONFIG.orderSite+"/comment/commentDetail/comment_id/"
	                   +comt.comment_id}}' target='_blank'>
	                   {{=comt.comment_content}}
	                   </a>
	                   </p>
	                   {{?comt.comment_images.length> 0}}
	                   <div class="content-img format-{{=comt.comment_images.length}}">
	                      {{~comt.comment_images:img:imindex}}
	                       <div class="img-{{=imindex}} img-block J_canZoomImg">
	                           <img class="commentImg" data-src="{{=img}}" alt="">
	                           <div class="loader loader-gray"></div>
	                       </div>
	                       {{~}}
	                   </div>
	                   {{?}}
	               </dt>
	               <dd class='user-comment-self-input'>
	                   <div class="input-block">
	                      <input type="text" placeholder="回复楼主" class='J_commentAnswerInput'/>
	                      <a href="javascript:void(0);" class='btn  answer-btn J_commentAnswerBtn'
	                      data-commentId = '{{=comt.comment_id}}'>回复</a>
	                   </div>
	               </dd>
	               {{?comt.reply_content}}
	               <dd class="user-comment-answer">
	                   <img class='self-image'
	      src="{{=MI.GLOBAL_CONFIG.assetsSite + '/i/logo.png'}}" alt="">
	                  <p>{{=comt.reply_content}}<span class='official-name'>官方回复</span>
	                 <a href="javascript:void(0);" class="J_csLike {{?comt.customer_status}}current {{?}}"
	                 data-commentid='{{=comt.comment_id}}'>
	                 <i class='iconfont'>&#xe60f;</i>赞客服&nbsp;
	                {{?comt.reply_up_num!=0}}
	                <span class='amount'>
	                 {{=parseInt(comt.reply_up_num)}}</span>
	                 {{?}}
	                 </a></p>
	               </dd>
	               {{?}}
	                {{~comt.user_replys:reply:replyindex}}
	               <dd class="user-comment-answer">
	                   <img class='self-image'
	             src="{{=reply.user_avatar}}" alt="">
	                   <p>{{=reply.reply_content}}- <span class='answer-user-name' >{{=reply.user_name}}</span> </p>
	               </dd>
	                {{~}}
	                {{?parseInt(comt.user_reply_num)>3}}
	               <dd class="user-comment-answer-more">

	              <a href='{{=MI.GLOBAL_CONFIG.orderSite+"/comment/commentDetail/comment_id/"
	                   +comt.comment_id}}' target='_blank'>
	                   查看全部{{=comt.user_reply_num}}条回复&gt;
	                </a>
	               </dd>
	               {{?}}
	           </dl>
	       </li>
	       {{~}}
	  */
console.log()});return t},timelineCommentTmpl:function(){var t=multiline(function(){/*!@tpl
	      {{~it:com:index}}
	      <li class='purple timelineunit J_commentContent'  data-id='{{=com.comment_id}}'>
	          <h4 class="line-time">{{=com.showTime}}</h4>
	          <p class="line-content">
	       <a href='{{=MI.GLOBAL_CONFIG.orderSite+"/comment/commentDetail/comment_id/"
	                   +com.comment_id}}' target='_blank'>
	          {{=com.comment_content}}
	         </a>
	          </p>
	          {{? com.comment_images.length!= 0}}
	          <div class="line-imglist">
	              <div class="line-time-img-block J_imgScrollListBlock" data-liwid='84'>
	                  <ul class="line-time-img J_imgList" style='width:{{=com.comment_images.length * 84}}px'>
	                      {{~com.comment_images: img: imgIndex}}
	                      <li class='con-img J_canZoomImg'>
	                          <img data-src="{{=img}}" class="commentImg" alt="">
	                      </li>
	                      {{~}}
	                  </ul>
	              </div>
	              {{?com.comment_images.length > 3}}
	              <ul class="nav-block " data-page='1' data-pageSize='3'>
	                  <div class="left-nav J_navleft dective">
	                    <i class="iconfont">&#xe629;</i>
	                  </div>
	                  <div class="right-nav J_navright">
	                    <i class="iconfont">&#xe624;</i>
	                  </div>
	              </ul>
	              {{?}}
	          </div>
	          {{?}}
	          <div class="line-foot">
	              <div class="line-left">来自于 {{=com.user_name}}</div>
	              <div class="line-right J_hasHelp {{?com.up_status}}current{{?}}" data-commentid="{{=com.comment_id}}">
	                  <i class="iconfont">&#xe60f;</i>有帮助&nbsp;&nbsp;<span class='amount'>{{?com.up_status}}
	                  {{=parseInt(com.up_num)+1}}{{??}}{{=parseInt(com.up_num)}}{{?}}</span>
	              </div>
	          </div>
	          <div class="line-dot item-rainbow-{{=com.randomIndex}}"></div>
	      </li>
	      {{~}}
	     */
console.log()});return t},replyContentTmpl:function(){var t=multiline(function(){/*!@tpl
	        {{~it:reply:replyindex}}
	          <dd class="user-comment-answer">
	              <img class='self-image'
	        src="{{=reply.user_avatar}}" alt="">
	              <p>{{=reply.reply_content}}- <span class='answer-user-name' >{{=reply.user_name}}</span> </p>
	          </dd>
	        {{~}}
	     */
console.log()});return t},zoomTmplDiv:function(){var t=multiline(function(){/*!@tpl
	    <div class="modal fade zoom-modal modal-hide" id='JimageModal'>
	    </div>
	     */
console.log()});return t},zoomImgTmpl:function(){var t=multiline(function(){/*!@tpl
	      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	      <div class="modal-body">
	          <div class="big-img-block J_zoomBigImgBlock">
	              <div class="big-img-container J_zoomImgContainer">
	                <img src="{{=it.curSrc}}" class='J_zoomBigImg' style='{{=it.cssStr}}' alt="">
	                <div class="loader"></div>
	                <div class="img"></div>
	              </div>
	              <ul class='rotate-forward J_zoomRotateBtn'>
	                <li class='left-for J_rotateLeft'>向左旋转</li>
	                <li class='right-for J_rotateRight'>向右旋转</li>
	              </ul>
	          </div>
	          {{?it.smlArr.length > 1}}
	          <ul class="big-img-nav J_zoomNav" data-index='{{=it.curIndex}}' data-amount ='{{=it.smlArr.length}}'>
	              <div class="left-nav nav-block J_zoomLeft {{?it.curIndex===0}}dective{{?}}">
	              <i class='iconfont'>&#xe627;</i></div>
	              <div class="right-nav nav-block J_zoomright {{?it.curIndex===(it.smlArr.length-1)}}dective{{?}}">
	              <i class='iconfont'>&#xe622;</i></div>
	          </ul>
	          {{?}}
	          <ul class="sml-img-nav" style='{{=it.smlNavCss}}'>
	              {{~it.smlArr: img: index}}
	              <li class='{{?index===it.curIndex}}current{{?}} J_zoomSmlImg'>
	                  <img src="{{=img.src}}" data-width='{{=img.width}}'
	                  data-height='{{=img.height}}' style='{{=img.cssStr}}' alt="">
	              </li>
	              {{~}}

	          </ul>
	      </div>
	     */
console.log()});return t}};t.exports=o},function(t,e){var o={jsonpCache:function(t,e){$.ajax({type:"GET",url:t,dataType:"jsonp",cache:!0,success:function(t){e(t)}})},jsonP:function(t,e){$.ajax({type:"GET",data:t.data?t.data:"",url:t.url,dataType:"jsonp",jsonp:"jsonpcallback",success:function(o){e(o,t)}})},imgLoad:function(t,e){var o=new Image;o.src=t.imgsrc,t.img=o,o.complete?e(t):(o.onload=function(){if("naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();e(t),o.onload=null},o.onerror=function(){t.isError=!0,e(t)})},revertStr:function(t){var e=String(t).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return encodeURIComponent(e)},dataToHtml:function(t){return t=String(t).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},calShowTime:function(t,e){var o=t;t=1e3*t;var i=e-o,a=86400,n=3600,s=60,r="",d=function(t){return parseInt(t)<10?"0"+t:t};if(i>=a){var l=i/a;if(l>7){var c=new Date(t).getFullYear(),m=new Date(t).getMonth()+1,u=new Date(t).getDate();r=c+"年"+m+"月"+u+"日"}else if(7>l&&l>=3){var g=["日","一","二","三","四","五","六"],p=new Date(t).getDay();r="星期"+g[p]}else if(3>l&&l>=2){var f=new Date(t).getHours(),h=new Date(t).getMinutes();r="前天 "+d(f)+":"+d(h)}else if(2>l){var v=new Date(t).getHours(),$=new Date(t).getMinutes();r="昨天 "+d(v)+":"+d($)}}else if(a>i&&i>=n){var C=parseInt(i/n);r=C+"小时前"}else if(n>i&&i>=s){var _=parseInt(i/s);r=_+"分钟前"}else s>i&&(r="刚刚");return r},syncLoginStatus:function(t,e){var o=t+"/user/proxy/stop/1",i="<iframe src='"+o+"' width='0' height='0' name='proxy' id='proxy' frameborder='0' scrolling='no'></iframe>";$(document.body).append(i),$("iframe[name='proxy']").load(function(){$("iframe[name='proxy']").remove(),e()})},multilineDot:function(){$(".figcaption").each(function(){for(var t=$(this).height(),e=$("p",$(this)).eq(0);e.outerHeight()>t;)e.text(e.text().replace(/(\s)*([a-zA-Z0-9]+|\W)(\.\.\.)?$/,"..."))})},scrollLeftRight:function(){var t=function(t,e){var o=parseInt(t.attr("data-page")),i=parseInt(t.attr("data-pageSize")),a=t.siblings(".J_imgScrollListBlock"),n=a.find("li").length,s=0;s=n%i===0?n/i:parseInt(n/i)+1;var r=0;if(r=e?o-1:o+1,1>r)return!1;if(r>s)return!1;1===r?($(".J_navleft").addClass("dective"),$(".J_navright").removeClass("dective")):r===s?($(".J_navleft").removeClass("dective"),$(".J_navright").addClass("dective")):($(".J_navleft").removeClass("dective"),$(".J_navright").removeClass("dective")),t.attr("data-page",r);var d=a.attr("data-liwid"),l=0;if(s>r)l=(r-1)*i*d;else if(n%i===0)l=(r-1)*i*d;else{var c=n%i;l=(r-2)*i*d+c*d}a.find("ul").animate({marginLeft:"-"+l+"px"},500)};$("body").on("click",".J_navleft",function(){var e=$(this).parent();t(e,!0)}),$("body").on("click",".J_navright",function(){var e=$(this).parent();t(e,!1)})},accAdd:function(t,e){var o,i,a,n;try{o=t.toString().split(".")[1].length}catch(s){o=0}try{i=e.toString().split(".")[1].length}catch(s){i=0}if(n=Math.abs(o-i),a=Math.pow(10,Math.max(o,i)),n>0){var r=Math.pow(10,n);o>i?(t=Number(t.toString().replace(".","")),e=Number(e.toString().replace(".",""))*r):(t=Number(t.toString().replace(".",""))*r,e=Number(e.toString().replace(".","")))}else t=Number(t.toString().replace(".","")),e=Number(e.toString().replace(".",""));return(t+e)/a},accSub:function(t,e){var o,i,a,n;try{o=t.toString().split(".")[1].length}catch(s){o=0}try{i=e.toString().split(".")[1].length}catch(s){i=0}return a=Math.pow(10,Math.max(o,i)),n=o>=i?o:i,((t*a-e*a)/a).toFixed(n)},supportCss3:function(t){var e,o=["webkit","Moz","ms","o"],i=[],a=document.documentElement.style,n=function(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})};for(e in o)o.hasOwnProperty(e)&&i.push(n(o[e]+"-"+t));i.push(n(t));for(e in i)if(i[e]in a)return!0;return!1},rediectLogin:function(t){var e="";e=t?t.url:location.href,location.href=MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+e},trimInit:function(){"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})},shareSina:function(t,e,o,i){window.open("http://service.weibo.com/share/share.php?title="+encodeURIComponent(t)+"&url="+encodeURIComponent(e)+"&appkey="+encodeURIComponent(o)+"&pic="+encodeURIComponent(i),"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes")},randomHeadImg:function(){var t=MI.GLOBAL_CONFIG.assetsSite+"/i/item/",e=["head_1.png","head_2.png","head_3.png","head_4.png"],o=parseInt(Math.random()*e.length),i=t+e[o];return i},showErrorModal:function(t,e){var o=multiline(function(){/*!@tpl
	      <div id="J_commentTipModal" class="modal fade modal-alert modal-hide">
	        <div class="modal-bd">
	            <div class="text">
	                <h3 class="title">{{=it.title}}</h3>
	            </div>
	            <div class="actions">
	                <button class="btn btn-primary" data-dismiss="modal">确定</button>
	            </div>
	            <a class="close" data-dismiss="modal" href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a>
	        </div>
	    </div>

	    */
console.log()}),i=multiline(function(){/*!@tpl
	      <div id="J_commentTipModal" class="modal modal-alert modal-hide">
	        <div class="modal-bd">
	            <div class="text">
	                <h3 class="title">{{=it.title}}</h3>
	            </div>
	            <div class="actions">
	                <button class="btn btn-gray" data-dismiss="modal">取消</button>
	                <button class="btn btn-primary J_TipEnsure" >确定</button>
	            </div>
	            <a class="close" data-dismiss="modal" href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a>
	        </div>
	    </div>

	    */
console.log()}),a=o;e&&(a=i);var n=doT.template(a),s={title:t},r=n(s),d=$("#J_commentTipModal").length;d>0&&$("#J_commentTipModal").remove(),$("body").append(r),$("#J_commentTipModal").modal("show")}};t.exports=o},function(t,e){function o(){return multiline(function(){/*!@tpl
	<div class="xm-pagenavi">
	  {{?it.pre}}
	  <a href="{{=it.opt.linkprefix}}{{=it.pre}}" class="numbers first"
	    data-pager="{{=it.pre}}"><span class="iconfont">&#xe629;</span></a>
	  {{??}}
	  <span class="numbers first"><span class="iconfont">&#xe629;</span></span>
	  {{?}}

	  {{?it.isF&&it.index==1}}
	  <span class="numbers current">1</span>
	  {{??it.isF&&it.index!=1}}
	  <a href="{{=it.opt.linkprefix}}1" class="numbers" data-pager="1">1</a>
	  {{?}}

	  {{?it.startXu}}
	  <span class="numbers">..</span>
	  {{?}}

	  {{for(var i=it.start;i<=it.end;i++){ }}
	  {{?i==it.index}}<span class="numbers current">{{=i}}</span>{{??}}
	  <a href="{{=it.opt.linkprefix}}{{=i}}" class="numbers" data-pager="{{=i}}">{{=i}}</a>{{?}}
	  {{ } }}

	  {{?it.endXu}}<span class="numbers">…</span>{{?}}

	  {{?it.isF&&it.index==it.pageAmount}}
	  <span class="numbers current">{{=it.pageAmount}}</span>
	  {{??it.isF&&it.index!=it.pageAmount}}
	  <a href="{{=it.opt.linkprefix}}{{=it.pageAmount}}" class="numbers"
	    data-pager="{{=it.pageAmount}}">{{=it.pageAmount}}</a>
	  {{?}}

	  {{?it.next}}
	  <a href="{{=it.opt.linkprefix}}{{=it.next}}" class="numbers last"
	    data-pager="{{=it.next}}"><span class='iconfont'>&#xe624;</span></a>{{??}}
	  <span class="numbers last"><span class='iconfont'>&#xe624;</span></span>
	  {{?}}
	</div>
	  */
console.log()})}var i=function(t,e,i,a){var n={};i||(i=1);var s={linkprefix:"#"};n.opt=$.extend({},s,a),n.index=i,n.start=1,n.end=e,n.pageAmount=e,n.endXu=!1,n.pre="",n.next=n.index+1,n.startXu=!1,n.isF=!1,1===i?(n.pre="",n.next=1===e?"":i+1):i===e?(n.next="",n.pre=1===e?"":i-1):(n.pre=i-1,n.next=i+1),8>e?(n.start=1,n.end=e):(n.isF=!0,5>i?(n.start=2,n.end=5,n.startXu=!1,n.endXu=!0):i>e-5?(n.start=e-5,n.end=e-1,n.startXu=!0,n.endXu=!1):(n.start=i-2,n.end=i+2,n.end>e-1&&(n.end=e-1),n.startXu=!0,n.endXu=!0));var r=o(),d=doT.template(r),l=d(n);t.html(l)};t.exports=i},function(t,e,o){MI.namespace("goodsQuestionTmpl, pagenav, itemUtil"),MI.goodsQuestionTmpl=o(7),MI.itemUtil=o(4),MI.pagenav=o(5);var i=function(t){var e=this;e.option=t,e.order="support",e.dataHelp=null,e.dataNewest=null,MI.itemUtil.trimInit()};i.prototype={constructor:i,getQuestionListData:function(t){var e=this,o=e.option.questionUrlHead+"/ask/askList?product_id="+e.option.proId+"&ask_mode=ask&order=support&pageindex="+t.pageIndex+"&pagesize="+t.pageSize,i=function(t){if(0===t.code){e.dataHelp=t,e.filterQuestionListData(t);var o=t.comments,i=o.length;i>0?($("#goodsFaqContent").removeClass("noContent"),$("#goodsFaqContent").addClass("hasContent")):($(".J_inputQuestion").attr("data-can-search",!1),$("#goodsFaqContent").removeClass("hasContent"),$("#goodsFaqContent").addClass("noContent"))}},a={url:o};MI.itemUtil.jsonP(a,i)},getNewestQuestionListData:function(t){var e=this,o=e.option.questionUrlHead+"/ask/askList?product_id="+e.option.proId+"&ask_mode=ask&order=addtime&pageindex="+t.pageIndex+"&pagesize="+t.pageSize,i=function(t){0===t.code&&(e.dataNewest=t,e.filterQuestionListData(t))},a={url:o};MI.itemUtil.jsonP(a,i)},filterQuestionListData:function(t){var e=t.comments,o=[],i=this;for(var a in e)if(e.hasOwnProperty(a)){var n=e[a],s=MI.itemUtil.calShowTime(n.add_timestamp,t.server_time),r=MI.itemUtil.calShowTime(n.reply_time,t.server_time);n.showQuestionTime=s,n.showAnswerTime=r,o.push(n.comment_id)}i.renderQuestionTmpl(t);var d={count:0,url:i.option.questionUrlHead+"/ask/checkAskUp?ask_ids="+o.join(",")};i.checkLikeStatus(d)},checkLikeStatus:function(t){var e=this,o=function(t){$("#J_goodsQuestionBlock").find("li").each(function(){var e=$(this).attr("data-id"),o=t[e];o&&$(this).find(".J_questionLike").addClass("current")})},i=function(t,i){if(0===t.code){var a=t.data;o(a)}else if(-1001===t.code&&(i.count++,1===i.count&&($.cookie("cUserId")||$.cookie("userId")))){var n=function(){$.proxy(e.checkLikeStatus(i),e)};MI.itemUtil.syncLoginStatus(e.option.questionUrlHead,n)}};MI.itemUtil.jsonP(t,i)},renderQuestionTmpl:function(t){var e=this;$("#J_goodsQuestionAmount")&&(parseInt(t.count)>6?$("#J_goodsQuestionAmount").html(t.count):$("#J_goodsQuestionAmount").parent().hide());var o=MI.goodsQuestionTmpl.questionTmpl(),i=doT.template(o);e.option.questionBlock.html(i(t.comments));var a=t.total_page,n=t.curr_page;$("#J_issuePagenav")&&(a>1?MI.pagenav($("#J_issuePagenav"),a,n):$("#J_issuePagenav").html(""))},likeQuestion:function(t){var e=this,o=function(t,o){if(0===t.code){1===t.data.up?o._curObj.addClass("current"):o._curObj.removeClass("current");var i=o._curObj.find(".hand-number").html();i=parseInt(i)+t.data.up,0>i&&(i=0),o._curObj.find(".hand-number").html(i)}else if(-1001===t.code&&(o.count++,1===o.count))if($.cookie("cUserId")||$.cookie("userId")){var a=function(){$.proxy(e.likeQuestion(o),e)};MI.itemUtil.syncLoginStatus(e.option.questionUrlHead,a)}else MI.itemUtil.rediectLogin()};MI.itemUtil.jsonP(t,o)},clickEvent:function(){var t=this;$("body").on("click",".J_questionHelp",function(){t.order="support",$(this).siblings("a").removeClass("current"),$(this).addClass("current");var e={pageIndex:1,pageSize:$(this).attr("data-pageSize")},o=$(".J_inputQuestion").val().trim();""!==o?t.searchConent(e):t.getQuestionListData(e)}),$("body").on("click",".J_questionNew",function(){t.order="addtime",$(this).siblings("a").removeClass("current"),$(this).addClass("current");var e={pageIndex:1,pageSize:$(this).attr("data-pageSize")},o=$(".J_inputQuestion").val().trim();""!==o?t.searchConent(e):t.getNewestQuestionListData(e)}),$("body").on("click",".J_questionLike",function(){var e=$(this),o=$(this).attr("data-id"),i=t.option.questionUrlHead+"/ask/upAsk?ask_id="+o,a={count:0,_curObj:e,url:i};t.likeQuestion(a)}),$("body").on("focus",".J_inputQuestion",function(){$(this).addClass("current")}),$("body").on("click",".J_btnQuestion",function(){var t=$(".J_inputQuestion").val().trim();return""===t?void MI.itemUtil.showErrorModal("提问内容不能为空"):void MI.itemUtil.showErrorModal("您确认提交此问题吗？",!0)}),$("body").on("click",".J_TipEnsure",function(){$("#J_commentTipModal").modal("hide"),t.askQuestion()});var e=!0,o=function(){e=!0;var o=$(".J_inputQuestion").attr("data-pageSize"),i={pageIndex:1,pageSize:o};t.searchConent(i)},i=function(){var t=(new Date).getTime();t-n>1e3&&(o(),clearInterval(a))},a=null,n=null;$("body").on("keyup",".J_inputQuestion",function(){var t=$(this).attr("data-can-search");return"false"===t?!1:void(e&&(e=!1,n=(new Date).getTime(),a=setInterval(i,200)))}),$("#J_issuePagenav").on("click",".numbers",function(){var e=$(this).attr("data-pager");if(!e)return!1;var o=$("#J_issuePagenav").attr("data-pageSize"),i={pageIndex:e,pageSize:o},a=$(".J_inputQuestion").val().trim();return""!==a?t.searchConent(i):t.getNewestQuestionListData(i),$("body,html").animate({scrollTop:0},500),!1})},postQuestion:function(t){var e=this,o=function(t,o){if(0===t.code)MI.itemUtil.showErrorModal("发表问题成功");else if(-1001===t.code){if(o.count++,1===o.count)if($.cookie("cUserId")||$.cookie("userId")){var i=function(){$.proxy(e.postQuestion(o),e)};MI.itemUtil.syncLoginStatus(e.option.questionUrlHead,i)}else MI.itemUtil.rediectLogin()}else-2===t.code&&MI.itemUtil.showErrorModal("您刚刚提交过该问题啦！ 知道了")};MI.itemUtil.jsonP(t,o)},askQuestion:function(){var t=this,e=$(".J_inputQuestion").val().trim(),o=MI.itemUtil.revertStr(e),i=t.option.proId,a=t.option.commodityId,n={count:0,url:t.option.questionUrlHead+"/ask/addAsk?product_id="+i+"&content="+o+"&ask_mode=ask&cid="+a};t.postQuestion(n)},searchConent:function(t){var e=this,o=$(".J_inputQuestion"),i=$(".J_inputQuestion").val().trim();if(""===i){var a=null;if($(".J_questionHelp").hasClass("current")){if(a=e.dataHelp,!a){var n={pageIndex:1,pageSize:$(".J_questionHelp").attr("data-pageSize")};return e.getQuestionListData(n),!1}}else if(a=e.dataNewest,!a){var s={pageIndex:1,pageSize:$(".J_questionNew").attr("data-pageSize")};return e.getNewestQuestionListData(s),!1}return $("#J_goodsQuestionBlock").show(),$(".J_questionOrderBlock").show(),$(".J_nullInfo").hide(),e.filterQuestionListData(a),!1}if(i.length>140)return MI.itemUtil.showErrorModal("字数不能超过140"),!1;var r=MI.itemUtil.revertStr(i),d=e.option.questionUrlHead+"/ask/search?product_id="+e.option.proId+"&words="+r+"&pagesize="+t.pageSize+"&pageindex="+t.pageIndex+"&order="+e.order,l={url:d,count:0,recover:function(){o.val(""),o.removeClass("showIn")}};return e.searchContentAjax(l),!1},searchContentAjax:function(t){var e=this,o=function(t,o){if(0===t.code)t.comments&&0!==t.comments.length?($("#J_goodsQuestionBlock").show(),$(".J_questionOrderBlock").show(),$(".J_nullInfo").hide()):($("#J_goodsQuestionBlock").hide(),$(".J_questionOrderBlock").hide(),$(".J_nullInfo").show()),e.filterQuestionListData(t);else if(-1001===t.code&&(o.count++,1===o.count))if($.cookie("cUserId")||$.cookie("userId")){var i=function(){$.proxy(e.searchContentAjax(o),e)};MI.itemUtil.syncLoginStatus(e.option.questionUrlHead,i)}else MI.itemUtil.rediectLogin()};MI.itemUtil.jsonP(t,o)},initQuestionList:function(){var t=this,e={pageIndex:1,pageSize:6};t.getQuestionListData(e),t.clickEvent()}},t.exports=i},function(t,e){var o={questionTmpl:function(){var t=multiline(function(){/*!@tpl
	      {{~it:faq:index}}
	      <li  data-id='{{=faq.comment_id}}'>
	          <div class="left-hand float ">
	              <div class="hand-block J_questionLike {{? faq.likeStatus}}current{{?}}" data-id={{=faq.comment_id}}>
	                  <i class="iconfont">&#xe60f;</i><br>
	                  <span class="hand-number">
	                  {{=faq.up_num}}</span>
	              </div>
	          </div>
	          <div class="mid-detail float ">
	              <h3 class="question-title"><a target='_blank' href='{{=MI.GLOBAL_CONFIG.itemSite+
	              "/comment/askDetail/gid/"+goodsConfig.commodityId+"/askid/"+faq.comment_id+"/pid/"+
	              goodsConfig.productId}}'>{{=faq.content}}</a></h3>
	              <div class="answer-content figcaption">
	              <p>
	              {{=faq.reply_content}}
	              </p>
	              </div>
	          </div>
	          <div class="right-date float">
	              <div class="question-title-date">{{=faq.showQuestionTime }}</div>
	              <div class="answer-content-date">{{=faq.showAnswerTime   }}</div>
	          </div>
	      </li>
	      {{~}}
	  */
console.log()});return t},questionAnswerTmpl:function(){var t=multiline(function(){/*!@tpl
	        {{~it:reply:replyindex}}
	          <div class="user-comment-answer">
	              <img class="self-image" src="{{=reply.user_avatar}}" alt="">
	              <p>
	                {{=reply.content}}
	                <span class="author-name">{{=reply.user_name}}</span>
	                <span class='create-date'>{{=reply.showtime}}</span>
	              </p>
	          </div>
	        {{~}}
	     */
console.log()});return t}};t.exports=o},function(t,e){var o={cartTmpl:function(){var t=multiline(function(){/*!@tpl
	     <a href="{{=it.nextStep}}" id="goodsDetailAddCartBtn" class="btn  btn-primary goods-add-cart-btn"
	       data-disabled="false" data-gid="{{=it.addCartGid}}" data-package="{{=it.needChioce}}">
	         <i class="iconfont "></i>加入购物车
	     </a>
	    */
console.log()});return t},barCartTmpl:function(){var t=multiline(function(){/*!@tpl
	      <a href="{{=it.nextStep}}" class="btn btn-primary goods-add-cart-btn"
	     id="goodsSubBarAddCartBtn" data-disabled="false" data-gid="{{=it.addCartGid}}"
	      data-package="{{=it.needChioce}}" >
	      <i class="iconfont">&#xe624;</i>加入购物车</a>
	    */
console.log()});return t},sizeTmpl:function(){var t=multiline(function(){/*!@tpl
	      {{~it:sizeObj:index}}
	           {{? sizeObj.is_sale}}
	           <li class=' '>
	               <a href="javascript:void(0);" class="item goodsStyle {{? sizeObj.is_cos}}disabled{{?}}"
	   data-id="{{=sizeObj.goods_id}}" data-price="{{=sizeObj.price}}"  data-is-cos="{{=sizeObj.is_cos}}" >
	                   {{=sizeObj.size}}
	               </a>
	           </li>
	           {{?}}
	           {{~}}
	    */
console.log()});return t},stockTmpl:function(){return"<a class='btn btn-disabled goods-over-btn'>暂时缺货</a>"},registerTmpl:function(t){return'<a href="'+t+'"  class="btn btn-gray goods-over-btn"><i class="iconfont" ></i>到货通知</a>'},detailTmpl:function(t){return'<a href="'+t+'" target="_blank" class="btn btn-primary goods-over-btn" ><span class="iconfont"></span>查看详情</a>'}};t.exports=o},function(t,e,o){function i(t,e,o){var i=t.find("a");$.each(i,function(t,i){var a,n=$(i).attr("data-stat-index"),s=r($(i).attr("data-stat-text")),d=$(i).attr("data-stat-method"),l=$(i).attr("data-stat-addcart");a=l?"stat_"+e+l+"."+o+"_"+n+"_"+d:"stat_"+e+"."+o+"_"+n+"_"+d,$(i).attr({"data-stat-pid":a,"data-stat-aid":s})})}function a(t){if("cart"!==s.page&&s.useCarousel){var e=t.find("ul").eq(0);e&&e.carousel({containerSelector:t,controls:s.carouselControl,pager:s.carouselPage,itemHeight:320})}s.isBuy&&($(".J_xm-recommend-list").hover(function(){$(this).find(".J_xm-recommend-btn").show()},function(){$(this).find(".J_xm-recommend-btn").hide()}),$(".J_xm-recommend-btn").off(".addcart").on("click.addcart",function(){function t(){o.removeClass("xm-recommend-notice-active"),setTimeout(function(){e.removeClass("disabled"),o.empty()},500)}var e=$(this),o=e.parent().siblings(".xm-recommend-notice");return e.hasClass("disabled")?!1:(MI.addShopCart(e.attr("data-stat-gid"),function(e){1===e.code?"cart"!==s.page?(o.addClass("xm-recommend-notice-active").empty().append('<a class="btn btn-block btn-green btn-notice" href="javascript: void(0);">成功加入购物车</a>'),o.find(".btn-notice").one("click",t),setTimeout(function(){t(),location.reload()},1e3)):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/":alert(e.msg)}),!1)})),i(t,s.page,s.pageName),$.isFunction($("body").linkSign)&&t.linkSign({live:!0});var o=t.attr("id"),a="re-"+s.page+"."+s.tips;$.force_appear(),t.appear(),t.one("appear",function(){if("undefined"!=typeof _msq&&_msq.push(["trackPanelShow",o,a]),!t.data("log_codes")){for(var e=t.find(".J_xm-recommend-list").find("dt").find("a"),i="",n=0,s=e.length;s>n;n++)i+=e.eq(n).data("log_code")+";";t.attr("data-log_codes",i.substring(0,i.length-1))}})}o(10),o(11);var n={},s={},r=function(t){try{return t.replace(/\s/g,"")}catch(e){return t}};!function(t){function e(t,e,i,n){if(t.length<5)return!1;var r=o(12),d={v:1,data:t,useCarousel:s.useCarousel,isBuy:s.isBuy,itemSite:MI.GLOBAL_CONFIG.itemSite,title:n?"买购物车中商品的人还看了":s.title,page:s.page,hideTitle:s.hideTitle,type:e.type};i.addClass("container").html(r(d)),a(i),null!==e.callback&&"function"==typeof e.callback&&e.callback()}function i(t){return t.length<5?!1:(t.length>20&&(t=t.slice(0,20)),t.length>15&&t.length<20&&(t=t.slice(0,15)),t.length>10&&t.length<15&&(t=t.slice(0,10)),t.length>5&&t.length<10&&(t=t.slice(0,5)),t)}function r(o){var a=s.api,r={cid:n.gid};t.ajax({url:a,dataType:"jsonp",jsonp:"jsonpcallback",cache:!0,data:r,success:function(a){if(0===a.code){a=a.data||{};var s=t(o);"buyRecommend"===n.type||"paySuccess"===n.type?(e(i(a.alsobuy),n,s),n.type="dirHistoryRecommend",s=t("#J_historyRecommend"),e(i(a.alsoview),n,s,!0)):e(i(a),n,s)}}})}var d={recommendBox:{api:"//rec.www.mi.com/rec/cartbuy",title:"买购物车中商品的人还买了",isBuy:!0,page:"Cart",pageName:"购物车",tips:"购物车推荐",useCarousel:!1},historyRecommend:{api:"//rec.www.mi.com/rec/cartempty",title:"为您推荐",isBuy:!0,page:"Cart",pageName:"购物车",tips:"猜你喜欢",useCarousel:!1},dirHistoryRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"根据浏览向您推荐",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"看了还看",useCarousel:!1},alsoBuy:{api:"//rec.www.mi.com/rec/detail",title:"买过该商品的人还买了",isBuy:!0,page:"ItemTail",pageName:"单品页底部",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},buyRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"买购物车中商品的人还买了",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},searchHistoryRecommend:{api:"//rec.www.mi.com/rec/search",title:"猜你喜欢",isBuy:!0,page:"Search",pageName:"搜索页",tips:"猜你喜欢",useCarousel:!0,carouselControl:!1,carouselPage:!0},homeRecommend:{api:"//rec.www.mi.com/rec/guesslike",title:"为你推荐",isBuy:!1,page:"Home",pageName:"首页",tips:"为你推荐",useCarousel:!0,carouselControl:!0,carouselPage:!1,hideTitle:!0},paySuccess:{api:"//rec.www.mi.com/rec/cartsuccess",title:"为你推荐",isBuy:!0,page:"CartSuc",pageName:"支付成功",tips:"为你推荐",useCarousel:!0,carouselControl:!1,carouselPage:!0}};t.fn.miRecommend=function(e){n=t.extend(d,e),s=n[n.type],r(this)}}(jQuery)},function(t,e){!function(t){function e(e){function o(){return 0>=$?!1:(_&&clearInterval(_),void(_=setTimeout(function(){var t=I===$-1?0:I+1;i(t),o()},p.pause)))}function i(t){return I===t?!1:(C.css({marginLeft:-h*f*t,transition:"margin-left "+p.speed/1e3+"s "+p.easing}),p.controls&&(0===t?c.addClass("control-disabled"):c.removeClass("control-disabled"),t===$-1?m.addClass("control-disabled"):m.removeClass("control-disabled")),p.pager&&u.find("li").eq(t).addClass("pager-active").siblings().removeClass("pager-active"),void(I=t))}function a(){for(var e='<ul class="xm-pagers">',o=0,a=$;a>o;o+=1)e+='<li class="pager'+(0===o?" pager-active":"")+'"><span class="dot">'+(o+1)+"</span></li>";e+="</ul>",u.html(e),u.find("li").off(".carousel").on("click.carousel",function(){t(this).addClass("pager-active").siblings().removeClass("pager-active"),i(u.find("li").index(t(this)))})}function n(){f=p.itemPerSlide||Math.ceil(r.width()/h),$=Math.ceil(d.length/f),1>=$||(i(0),p.pager&&a(),p.auto&&(o(),p.controls&&l.find(".control").off(".carousel").on({"mouseenter.carousel":function(){_&&clearTimeout(_)},"mouseleave.carousel":function(){o()}}),p.pager&&u.find(".pager").off(".carousel").on({"mouseenter.carousel":function(){_&&clearTimeout(_)},"mouseleave.carousel":function(){o()}})))}var s,r,d,l,c,m,u,g,p,f,h,v,$,C=t(this),_=0,I=-1;return g={itemSelector:"> li",itemWidth:null,itemHeight:null,itemPerSlide:null,containerSelector:null,controlsSelector:null,pagersSelector:null,speed:500,easing:"ease",auto:!1,pause:5e3,controls:!0,controlsClass:"xm-controls-line-small",pager:!1,onLoad:t.noop},p=t.extend({},g,e),d=C.find(p.itemSelector),p.itemPerSlide&&d.length<=p.itemPerSlide?this:(h=p.itemWidth||d.outerWidth(!0),v=p.itemHeight||d.outerHeight(),s=p.containerSelector?C.closest(p.containerSelector):C.parent(),s.addClass("xm-carousel-container"),r=C.wrap('<div class="xm-carousel-wrapper"></div>').closest(".xm-carousel-wrapper").css({height:v,overflow:"hidden"}),C.css("width",h*d.length),p.controls&&(l=t('<div class="xm-controls '+p.controlsClass+' xm-carousel-controls"><a class="control control-prev iconfont" href="javascript: void(0);">&#xe628;</a><a class="control control-next iconfont" href="javascript: void(0);">&#xe623;</a></div>'),p.controlsSelector?s.find(p.controlsSelector).append(l):l.insertAfter(r),c=l.find(".control-prev"),m=l.find(".control-next"),c.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(I-1)}),m.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(I+1)})),p.pager&&(u=t('<div class="xm-pagers-wrapper"></div>'),p.pagersSelector?s.find(p.pagersSelector).append(u):u.insertAfter(r)),n(),p.onLoad(C),void t(window).on("resize",n))}t.fn.carousel=function(t){return this.each(function(){e.call(this,t)}),this}}(jQuery)},function(t,e){!function(t){function e(){n=!1;for(var e=0,a=i.length;a>e;e++){var s=t(i[e]).filter(function(){return t(this).is(":appeared")});if(s.trigger("appear",[s]),o){var r=o.not(s);r.trigger("disappear",[r])}o=s}}var o,i=[],a=!1,n=!1,s={interval:250,force_process:!1},r=t(window);t.expr[":"].appeared=function(e){var o=t(e);if(!o.is(":visible"))return!1;var i=r.scrollLeft(),a=r.scrollTop(),n=o.offset(),s=n.left,d=n.top;return d+o.height()>=a&&d-(o.data("appear-top-offset")||0)<=a+r.height()&&s+o.width()>=i&&s-(o.data("appear-left-offset")||0)<=i+r.width()?!0:!1},t.fn.extend({appear:function(o){var r=t.extend({},s,o||{}),d=this.selector||this;if(!a){var l=function(){n||(n=!0,setTimeout(e,r.interval))};t(window).scroll(l).resize(l),a=!0}return r.force_process&&setTimeout(e,r.interval),i.push(d),t(d)}}),t.extend({force_appear:function(){return a?(e(),!0):!1}})}(jQuery)},function(t,e){t.exports=function(t){var e="";t.title&&!t.hideTitle&&(e+='<h2 class="xm-recommend-title"><span>'+t.title+"</span></h2>"),e+='<div class="xm-recommend"> ',e+=t.useCarousel?' <ul class="xm-carousel-col-5-list xm-carousel-list clearfix"> ':' <ul class="row clearfix"> ';var o=t.data;if(o)for(var i,a=-1,n=o.length-1;n>a;){i=o[a+=1],e+=" ",e+=t.useCarousel?' <li class="J_xm-recommend-list"> ':' <li class="J_xm-recommend-list span4"> ',e+=" ";var s=/.jpg|.jpeg|.png/,r=s.exec(i.image),d="!140x140"+r,l="!280x280"+r;if(e+=" ",i.ext&&i.ext.img&&i.ext.url){e+=" ";var s=/.jpg|.jpeg|.png/,c=s.exec(i.ext.img),m="!234x300"+c,u="!468x600"+c;e+=' <a target="_blank" href="'+i.ext.url+'" data-log_code="'+i.logcode+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+a+' data-stat-text="'+i.name+'"> <img src="'+i.ext.img.replace(/.jpg|.png|.jpeg/,m)+'" srcset="'+i.ext.img.replace(/.jpg|.png|.jpeg/,u)+'  2x" alt="'+i.name+'" /> </a> '}else e+=' <dl> <dt> <a href="'+t.itemSite+"/"+i.commodityid+'.html" data-log_code="'+i.logcode+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+a+' data-stat-text="'+i.name+'" target="_blank"> <img src="'+i.image.replace(/.jpg|.png|.jpeg/,d)+'" srcset="'+i.image.replace(/.jpg|.png|.jpeg/,l)+'  2x" alt="'+i.name+'" /> </a> </dt> <dd class="xm-recommend-name"> <a href="'+t.itemSite+"/"+i.commodityid+'.html" data-log_code="'+i.logcode+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+a+' target="_blank"> '+i.name+' </a> </dd> <dd class="xm-recommend-price">'+i.price+'元</dd> <dd class="xm-recommend-tips"> ',i.comments&&(e+=" ",parseInt(i.comments)>0&&(e+=" "+i.comments+"人好评 "),e+=" "),e+=" ",t.isBuy&&(e+=' <a href="'+t.itemSite+"/cart/add/"+i.goodsid+'-0-1" data-log_code="'+i.logcode+'" data-stat-gid="'+i.goodsid+'" data-stat-method="'+t.v+"_"+i.algorithm+'" data-stat-index='+a+' data-stat-text="'+i.name+'" data-stat-addcart="加购" class="btn btn-small btn-line-primary J_xm-recommend-btn">加入购物车</a> '),e+=' </dd> <dd class="xm-recommend-notice"></dd> </dl> ';e+=" </li>"}return e+="</ul></div>"}},function(t,e){!function(t){function e(e){function o(){for(var e=-1,o=t(document).scrollTop(),i=0,a=l.length;a>i&&o+s.viewport.height()>l[i];i+=1)e+=1;return e}function i(){var e=o();d!==e&&(d=e,r.filter(function(e){return d>=e&&!t(this).hasClass(s.visibleClass)}).addClass(s.visibleClass).trigger("visible.visibleWatcher"),s.onVisible(r.eq(d),d))}function a(){r.each(function(){var e=t(this).attr("data-offset")?Number(t(this).attr("data-offset")):s.offset,o=e%1===0?e:e*s.viewport.height();l.push(t(this).offset().top+o)}),i(),s.onLoad()}var n,s,r=t(this),d=-1,l=[];n={viewport:t(window),visibleClass:"is-visible",offset:300,onLoad:t.noop,onVisible:t.noop},s=t.extend({},n,e),a(),s.viewport.on({"scroll.visibleWatcher":i,"resize.visibleWatcher":a})}t.fn.visibleWatcher=function(t){return e.call(this,t),this}}(jQuery)},function(t,e,o){o(15),MI.namespace("buyChooseAddress"),MI.buyChooseAddress={init:function(t){var e=this,o={isShowStreet:!0,showTrigger:"#J_switchChooseRegions",afterChoose:$.noop};e.options=$.extend(o,t),e.apiUrl={my:MI.GLOBAL_CONFIG.orderSite+"/address/getAddressList","default":MI.GLOBAL_CONFIG.orderSite+"/address/getDefaultAddress",search:MI.GLOBAL_CONFIG.orderSite+"/address/searchByKeywords",translate:MI.GLOBAL_CONFIG.orderSite+"/address/getAreaInfoByLocation",save:MI.GLOBAL_CONFIG.orderSite+"/address/setDefaultAddress",login:MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href},e.$userDefault=$("#J_userDefaultAddress"),e.$input=$("#J_searchRegionsInput"),e.$inputClear=$("#J_searchRegionsInputClear"),e.$searchWrapper=$("#J_searchAddressWrapper"),e.$loading=e.$searchWrapper.find(".loading"),e.$myAddr=e.$searchWrapper.find("#J_myAddress"),e.$myAddrList=e.$myAddr.find(".list"),e.$noLogin=e.$myAddr.find("#J_noLogin"),e.$nearbyAddr=e.$searchWrapper.find("#J_nearbyAddress"),e.$nearbyAddrList=e.$nearbyAddr.find(".list"),e.$searchAddr=e.$searchWrapper.find("#J_searchAdress"),e.$searchAddrList=e.$searchAddr.find(".list"),e.$noResult=e.$searchWrapper.find("#J_noSearchResult"),e.searchVal=null,e.nearbyData=null,e.myData=null,e.$noLogin.find("a").attr("href",e.apiUrl.login),e.selectAddress=new MI.fourAddress,e.selectAddress.init({selectEnd:function(t){e.formatChooseResult(t)}}),e.checkLogin(),e.searchEvent(),e.selectEvent(),e.switchType(),e.getDefaultAddress(),e.showChooseRegions()},showChooseRegions:function(){var t=this,e=$("#J_modalChooseRegions");$(t.options.showTrigger).on("click",function(){var o=t.$userDefault.offset();$(window).scrollTop()+$(window).height()<o.top+e.height()&&(o.top-=e.height(),o.top+=$("#J_userDefaultAddress").height()),e.css({top:o.top,left:o.left}).modal("show").one("hidden",function(){t.revert()}),t.getMyAddress()})},checkLogin:function(){this.isLogin=$.cookie("cUserId")?!0:!1},revert:function(){this.$input.val(""),this.searchVal=null,this.toggleShow(this.$myAddr,!0),this.toggleShow(this.$nearbyAddr,!1),this.toggleShow(this.$searchAddr,!1),this.toggleShow(this.$noResult,!1)},searchEvent:function(){var t,e,o=this,i=200;o.$input.on({focus:function(){o.toggleShow(o.$myAddr,!1),o.toggleShow(o.$loading,!0),o.searchVal?o.searchAddress():o.nearbyData?o.formatAddress(o.nearbyData,null,"nearby"):o.searchAddress()},blur:function(){e&&clearTimeout(e),e=setTimeout(function(){o.toggleShow(o.$nearbyAddr,!1),o.toggleShow(o.$searchAddr,!1),o.toggleShow(o.$noResult,!1),o.toggleShow(o.$myAddr,!0),$(".J_switchTypeTrigger").eq(0).show()},200)},keyup:function(){t&&clearTimeout(t),t=setTimeout(function(){o.searchVal=$.trim(o.$input.val().replace(/[\-_'=+|\\\/]/g," ")),o.searchVal?o.toggleShow(o.$inputClear,!0):o.toggleShow(o.$inputClear,!1),o.toggleShow(o.$myAddr,!1),o.toggleShow(o.$nearbyAddr,!1),o.toggleShow(o.$searchAddr,!1),o.toggleShow(o.$noResult,!1),o.toggleShow(o.$loading,!0),o.searchAddress()},i)}}),o.$inputClear.on("click",function(){o.searchVal=null,o.$input.val("").focus(),o.toggleShow(o.$inputClear,!1)})},selectEvent:function(){var t=this;t.$myAddrList.on("click",".J_addrItem",function(){var e=$(this).index();t.myData[e].address_id={id:$(this).data("id")},delete t.myData[e].consignee,t.formatChooseResult(t.myData[e])}),$.each([t.$nearbyAddrList,t.$searchAddrList],function(e,o){o.on("click",".J_addrItem",function(){var e=$(this).attr("data-code"),o=$(this).attr("data-location");t.translateSearchResult({code:e,location:o})})})},toggleShow:function(t,e){e?t.removeClass("hide"):t.addClass("hide")},switchType:function(){$(".J_switchTypeTrigger").on("click",function(){var t=$(this).attr("data-type");t&&$(".J_chooseRegionsBox[data-type="+t+"]").removeClass("hide").siblings(".J_chooseRegionsBox").addClass("hide")})},getDefaultAddress:function(){var t=this,e={url:t.apiUrl["default"],dataType:"jsonp",jsonp:"jsonpcallback",timeout:3e4,cache:!0,error:function(){},success:function(e){e&&1===e.code&&t.formatChooseResult(e.data,!0)}};window.ref_goods&&(e.data={},e.data.ref_goods=window.ref_goods),$.ajax(e)},getMyAddress:function(){var t=this;return t.isLogin?void(t.myData||$.ajax({url:t.apiUrl.my,dataType:"jsonp",jsonp:"jsonpcallback",timeout:3e4,cache:!0,error:function(){},success:function(e){e&&1===e.code?(t.myData=e.data,t.formatAddress(e.data,t.myAddressPage,"my")):-2===e.code&&(t.toggleShow(t.$loading,!1),t.toggleShow(t.$myAddr,!0))}})):(t.toggleShow(t.$loading,!1),void t.toggleShow(t.$myAddr,!0))},searchAddress:function(){var t=this,e=t.searchVal?"search":"nearby";$.ajax({url:t.apiUrl.search,dataType:"jsonp",jsonp:"jsonpcallback",data:{keywords:t.searchVal},timeout:3e4,cache:!0,error:function(){},success:function(o){if(o&&1===o.code){if(!o.data||!o.data.length)return t.toggleShow(t.$loading,!1),void("search"===e&&(t.toggleShow(t.$noResult,!0),$(".J_switchTypeTrigger").eq(0).hide()));t.searchVal||(t.nearbyData=o.data),t.formatAddress(o.data.slice(0,5),null,e)}}})},formatAddress:function(t,e,o){if(t){var i=this,a=multiline(function(){/*!@tpl
	        {{~it :value:index}}
	            <li class="J_addrItem" data-id="{{=value.address_id}}">
	                <div class="address-title">
	                    <span class="item">{{=value.consignee}}</span>
	                    <span class="item">{{=value.province.name}}</span>
	                </div>
	                <div class="address-desc">
	                    {{=value.city.name}}{{=value.district.name}}{{=value.area.name}}
	                </div>
	            </li>
	        {{~}}
	        */
console.log()}),n=multiline(function(){/*!@tpl
	        {{~it :value:index}}
	            <li class="J_addrItem" data-code="{{=value.adcode ? value.adcode : ''}}"
	            data-location="{{=value.location}}" data-id="{{=value.address_id}}">
	                <div class="address-title">
	                    <span class="item">{{=value.name}}</span>
	                </div>
	                <div class="address-desc">
	                    {{=value.pname}}{{=value.cityname}}{{=value.adname}}
	                </div>
	                <a class="btn btn-primary">选择</a>
	            </li>
	        {{~}}
	        */
console.log()}),s="";i.toggleShow(i.$loading,!1),i.toggleShow(i.$myAddr,!1),i.toggleShow(i.$noResult,!1),o&&"my"===o?(s=doT.template(a)(t),i.$myAddrList.html(s),i.toggleShow(i.$noLogin,!1),i.toggleShow(i.$myAddr,!0)):"nearby"===o?(s=doT.template(n)(t),i.$nearbyAddrList.html(s),i.toggleShow(i.$nearbyAddr,!0)):"search"===o&&(s=doT.template(n)(t),i.$searchAddrList.html(s),i.toggleShow(i.$searchAddr,!0)),"function"==typeof e&&$.proxy(e,i)()}},myAddressPage:function(){function t(){a.$myAddrList.css({"margin-top":u*(l-1)*-1+"px"}),i.text(l)}var e,o,i,a=this,n=a.$myAddrList.find(".J_addrItem"),s=n.length,r=4,d=s%r>0?parseInt(s/r)+1:s/r,l=1,c=multiline(function(){/*!@tpl
	          <div class="page-controller">
	              <a href="javascript:void(0);" class="iconfont page-prev">&#xe629;</a>
	              <span class="page-num"><i class="curr">{{=it.curr}}</i> / <i class="total">{{=it.total}}</i></span>
	              <a href="javascript:void(0);" class="iconfont page-next">&#xe624;</a>
	          </div>
	        */
console.log()}),m="",u=2*n.outerHeight();1>=d||(a.$myAddrList.parent().css({height:u,overflow:"hidden"}),m=doT.template(c)({curr:l,total:d}),a.$myAddr.append(m),i=a.$myAddr.find(".curr"),o=a.$myAddr.find(".page-next"),e=a.$myAddr.find(".page-prev"),e.on("click",function(){l>1&&(l-=1),t()}),o.on("click",function(){d>l&&(l+=1),t()}))},translateSearchResult:function(t){var e=this;$.ajax({url:e.apiUrl.translate,dataType:"jsonp",jsonp:"jsonpcallback",data:{adcode:t.code,location:t.location},timeout:3e4,error:function(){},success:function(t){t&&1===t.code&&e.formatChooseResult(t.data)}})},isjson:function(t){return"object"!=typeof t||"[object object]"!==Object.prototype.toString.call(t).toLowerCase()||t.length?!1:!0},formatChooseResult:function(t,e){var o=this,i="",a=[],n="";$.each(t,function(t,e){"mihome_id"===t?(n=e,o.options.mihomeId=e):"address_id"===t?a.push({id:e.id}):o.isjson(e)&&a.push({id:e.id,name:e.name})}),e||o.saveResult(a),$.each(a,function(t,e){!o.options.isShowStreet&&t>=4||e.name&&(i+='<span class="item">'+e.name+"</span>")}),o.$userDefault.removeClass("hide").find(".address-info").html(i),"function"==typeof o.options.afterChoose&&o.options.afterChoose(a,n)},saveResult:function(t){var e=this,o={};o=t.length>4?{address_id:{id:t[0].id||""},province:{id:t[1].id,name:t[1].name},city:{id:t[2].id,name:t[2].name},district:{id:t[3].id,name:t[3].name},area:{id:t[4].id,name:t[4].name}}:{province:{id:t[0].id,name:t[0].name},city:{id:t[1].id,name:t[1].name},district:{id:t[2].id,name:t[2].name},area:{id:t[3].id,name:t[3].name}},$.ajax({url:e.apiUrl.save,dataType:"jsonp",jsonp:"jsonpcallback",data:{address:o},timeout:3e4,error:function(){},success:function(){}})}}},function(t,e){MI.namespace("fourAddress"),MI.fourAddress=function(){this.options={wrapperElm:"#J_selectAddressWrapper",optionsWrapper:".J_optionsWrapper",selectWrapper:"#J_selectWrapper",maxLevel:4,afterFormat:$.noop,selectEnd:$.noop}},MI.fourAddress.prototype={constructor:MI.fourAddress,init:function(t){var e=this;"object"==typeof t&&(e.options=$.extend(e.options,t)),e.$wrapper=$(e.options.wrapperElm),e.$wrapper.length&&(e.addrUrl="//s1.mi.com/open/common/js/address_all_new.js?v=7930814",e.addressData=[],e.addrTemp=multiline(function(){/*!@tpl
	          <div class="select-box clearfix" id="J_selectWrapper">
	              <div class="select-first select-item J_select" data-init-txt="选择省份/自治区">选择省份/自治区</div>
	              <div class="select-item J_select hide" data-init-txt="选择城市/地区"></div>
	              <div class="select-item J_select hide" data-init-txt="选择区县"></div>
	              <div class="select-last select-item J_select hide" data-init-txt="选择配送区域"></div>
	          </div>

	          <div class="options-box">
	              <ul class="options-list J_optionsWrapper clearfix">
	                  {{~it :value:index}}
	                      <li class="option J_option"
	                      data-value="{{=value.id}}"
	                      data-txt="{{=value.name}}">{{=value.name}}
	                      </li>
	                  {{~}}
	              </ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	          </div>
	        */
console.log()}),e.optionTemp=multiline(function(){/*!@tpl
	          {{~it :value:index}}
	            {{? value.region_id}}
	            <li class="J_option" data-txt="{{=value.region_name}}" data-value="{{=value.region_id}}">
	            {{=value.region_name}}</li>
	            {{?? }}
	            <li class="J_option" data-txt="{{=value.name}}" data-value="{{=value.id}}"
	            data-zipcode="{{=value.zipcode ? value.zipcode : ''}}">{{=value.name}}</li>
	            {{? }}
	          {{~}}
	        */
console.log()}),e.result={},e.lastLevel=e.options.maxLevel-1,e.getAllRegions())},getAllRegions:function(){var t=this;$.ajax({url:t.addrUrl,dataType:"script",cache:!0,timeout:3e4,error:function(){},success:function(){"undefined"!=typeof window.data&&(t.addressData=window.data),t.formatRegions()}})},formatRegions:function(){var t=this,e=doT.template(t.addrTemp),o=e(t.addressData);t.$wrapper.html(o),t.$optionsWrapper=t.$wrapper.find(t.options.optionsWrapper),t.$selectWrapper=t.$wrapper.find(t.options.selectWrapper),t.selectEvent(),"function"==typeof t.options.afterFormat&&t.options.afterFormat()},selectEvent:function(){var t=this,e=0;t.$selectWrapper.on("click.seladdr",".J_select",function(){var o=$(this).addClass("active"),i=$(this).attr("data-init-txt");o&&(e=$(this).index(),t.$selectWrapper.find(".J_select:gt("+e+")").addClass("hide").removeClass("active"),t.$optionsWrapper.addClass("hide").eq(e).removeClass("hide"),$(this).html(i).removeClass("active"))}),t.$optionsWrapper.on("click.seladdr",".J_option",function(){var o=parseInt($(this).attr("data-value")),i=$(this).attr("data-txt"),a=$(this).attr("data-zipcode")||"",n=e+1,s=t.$selectWrapper.find(".J_select").eq(n);return t.result[e]={id:o,name:i,zcode:a},t.$selectWrapper.find(".J_select").eq(e).html(i).addClass("active"),e===t.lastLevel?void("function"==typeof t.options.selectEnd&&t.options.selectEnd(t.result)):(e+=1,n>=t.lastLevel?t.getLastLevelData():t.formatNextLevelOption(o,n),void(s.length&&s.html(s.attr("data-init-txt")).removeClass("hide")))})},getAddressLevelData:function(t){var e=[],o=this;return $.each(o.addressData,function(o,i){return i.id===t?(e=i.child,!1):void(i.child&&$.each(i.child,function(o,i){return i.id===t?(e=i.child,!1):void(i.child&&$.each(i.child,function(o,i){return i.id===t?(e=i.tags,!1):void 0}))}))}),e},formatNextLevelOption:function(t,e){if(t){var o=this,i=o.getAddressLevelData(t,e),a=o.formatOption(i);o.$optionsWrapper.addClass("hide").eq(e).html(a).removeClass("hide"),1===i.length&&setTimeout(function(){o.$optionsWrapper.eq(e).find(".J_option").eq(0).trigger("click")},50)}},getLastLevelData:function(){var t=this,e=MI.GLOBAL_CONFIG.orderSite+"/api/getAddressRegion.php";t.$optionsWrapper.addClass("hide").eq(t.lastLevel).html('<div class="loading"><div class="loader"></div></div>').removeClass("hide"),$.ajax({url:e,dataType:"jsonp",jsonp:"jsonpcallback",data:{parent:t.result[2].id},tiemout:3e4,error:function(){},success:function(e){if(e&&e.data.regions){var o=[];$.each(e.data.regions,function(t,e){o.push(e)});var i=t.formatOption(o);t.$optionsWrapper.eq(t.lastLevel).html(i)}}})},formatOption:function(t){var e=this,o="";return t?o=doT.template(e.optionTemp)(t):void 0},getResult:function(){return this.result}}},function(t,e){var o=function(t){var e={type:"GET",url:t.url,dataType:"jsonp",jsonp:"jsonpcallback",data:t.data||"",timeout:1e4,error:function(e){var o=t.error;o&&o(e)},success:function(e){var o=t.callback;o&&o(e)}};t.jsonpCallback&&(e.jsonpCallback=t.jsonpCallback),$.ajax(e)},i=function(){var t={isLogin:$.cookie("cUserId")?!0:!1,orderapi:window.orderapi_host,orderSite:MI.GLOBAL_CONFIG.orderSite||"//order.mi.com",loginUrl:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/site/login?redirectUrl="+location.href},e=window.goodsConfig.defaultGoodsId;window.goodsConfig.isPackage&&(e=window.goodsConfig.commodityId);var i=function(){$(".J_cancleBtn").addClass("btn-line-primary J_setRemind").removeClass("btn-gray J_cancleBtn").html("到货通知")},a=function(){$(".J_setRemind").removeClass("btn-line-primary J_setRemind").addClass("btn-gray J_cancleBtn").html("取消到货通知")};$("body").on("click",".J_setRemind",function(i){i.preventDefault(),o({url:t.orderSite+"/misc/onsaleRegister",data:{goods_id:e},callback:function(e){1===e.code?(a(),$("#J_setRemindModal").modal("show")):-2===e.code&&(window.location.href=t.loginUrl)}})}),$("body").on("click",".J_cancleBtn",function(a){a.preventDefault(),o({url:t.orderSite+"/misc/onsaleCleanup",data:{goods_id:e},callback:function(e){1===e.code?i():-2===e.code&&(window.location.href=t.loginUrl)}})}),o({url:t.orderSite+"/misc/onsaleCheck",data:{goods_list:e},callback:function(t){1===t.code&&0!==t.data.length&&""!==t.data[e]&&a()}})};t.exports=i},function(t,e){t.exports=function(t){var e="",o=t;if(o)for(var i,a=-1,n=o.length-1;n>a;)i=o[a+=1],e+=i.url&&""!=i.url?'<a class="hover" href="'+i.url+'" target="_blank" title="'+i.desc+'">':'<a href="javascript:void(0);" title="'+i.desc+'">',e+=" ",e+=i.is_check?' <i class="iconfont" >&#xe618;</i> ':' <i class="iconfont">&#xe90c;</i> ',e+=" "+i.title+"</a>";return e}}]);